<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="shortcut icon" href="icons/pyfav.png" type="image/png" />
<link href="index.html" title="はじめての統計データ分析" rel="start" />
<link href="index.html" title="はじめての統計データ分析" rel="first" />
<link href="index.html" rel="contents" title="Contents" />
<link rel="index" title="Index" />
<link href="sect0004.html" rel="next" />
<link href="sect0002.html" rel="prev" />
<link href="index.html" rel="parent" />
<meta name="aesop" content="information" />
<title>3 独立した2群の差の推測</title>
</head>
<body>
<div class="navigation">
<div id="top-navigation-panel" xml:id="top-navigation-panel">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class="online-navigation"><a title="2 MCMCと正規分布の推測" href="sect0002.html" rel="prev"><img src="icons/previous.png" border="0" height="32" alt="Previous Page" width="32" /></a></td>
<td class="online-navigation"><a title="はじめての統計データ分析" href="index.html" rel="parent"><img src="icons/up.png" border="0" height="32" alt="Up One Level" width="32" /></a></td>
<td class="online-navigation"><a title="対応のある2群のデータ" href="sect0004.html" rel="next"><img src="icons/next.png" border="0" height="32" alt="Next Page" width="32" /></a></td>
<td align="center" width="100%">はじめての統計データ分析</td>
<td class="online-navigation"><a href="index.html" rel="contents" title="Table of Contents"><img src="icons/contents.png" border="0" height="32" alt="Contents" width="32" /></a></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" alt="" width="32" /></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" width="32" /></td>
</tr></table>
<div class="online-navigation">
<span><b class="navlabel">Previous:</b>
<a href="sect0002.html" class="sectref" rel="prev">MCMCと正規分布の推測</a></span>
<span><b class="navlabel">Up:</b>
<a href="index.html" class="sectref" rel="parent">はじめての統計データ分析</a></span>
<span><b class="navlabel">Next:</b>
<a href="sect0004.html" class="sectref" rel="next">対応のある2群のデータ</a></span>
</div>
<hr /></div>
</div>



<div><h1 id="a0000000004">3 独立した2群の差の推測</h1>
<h2 id="a0000000049">3.4 非重複度</h2>
<h4 id="a0000000050">非重複度（Cohen の <img src="images/img-0029.png" alt="$U_3$" style="vertical-align:-3px; 
                                     width:16px; 
                                     height:14px" class="math gen" />）</h4>
<p> 第1群<a href="#a0000000051" class="footnote"><sup class="footnotemark">1</sup></a>の平均値 <img src="images/img-0030.png" alt="$\mu _1$" style="vertical-align:-3px; 
                                     width:16px; 
                                     height:10px" class="math gen" /> は、第2群では何%点に相当するか。  </p><table id="a0000000052" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0031.png" alt="\begin{equation}  U_3=F(\mu _1|\mu _2,\sigma ) \end{equation}" style="width:121px; 
                            height:18px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.17</span>)</span></td>
</tr>
</table><div id="fig0302" class="figure"><center> 
<img src="images/img-0032.png" alt="\includegraphics[width=8cm]{fig0302.png}" style="width:8cm" /> <div class="caption"><b>Figure 3.1</b>: <span>非重複度</span></div>  </center></div><p>実験群と統制群で非重複度が <img src="images/img-0033.png" alt="$80\% $" style="vertical-align:-1px; 
                                     width:29px; 
                                     height:15px" class="math gen" /> であれば、 その処置によって平均的な生徒が全体の <img src="images/img-0034.png" alt="$30\%  (=80\% -50\% )$" style="vertical-align:-4px; 
                                     width:140px; 
                                     height:18px" class="math gen" /> を追い抜くと解釈できる<a href="#a0000000053" class="footnote"><sup class="footnotemark">2</sup></a>。 </p><p>非重複度がある基準確率 <img src="images/img-0022.png" alt="$c$" style="vertical-align:0px; 
                                     width:7px; 
                                     height:7px" class="math gen" /> よりも大きい確率は、生成量  </p><table id="a0000000054" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0035.png" alt="\begin{equation}  u_{U_3&gt;c}^{(t)} = g(\mu _1^{(t)},\mu _2^{(2)},\sigma ^{(t)}) = \begin{cases}  1~ ~ ~ ~ U_3^{(t)} &gt; c \\ 0~ ~ ~ ~ U_3^{(t)} \leq c \\ \end{cases} \end{equation}" style="width:305px; 
                            height:50px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.21</span>)</span></td>
</tr>
</table><p> で計算することができる。 </p><h2 id="a0000000055">3.5 優越率</h2>
<h4 id="a0000000056">優越率（probability of dominance）</h4>
<p> 無作為に選んだ一方の群の測定値が、無作為に選んだ他方の群の測定値を上回る確率。 </p><table id="a0000000057" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0036.png" alt="\begin{equation}  x_1^* -x_2^* \sim N(\mu _1-\mu _2,\sqrt{2} \sigma ) \end{equation}" style="width:198px; 
                            height:19px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.25</span>)</span></td>
</tr>
</table><p> から、 </p><table id="a0000000058" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0037.png" alt="\begin{equation}  \pi _ d = p(x^*_1-x_2^* &gt; 0) = p \left( z &lt; \frac{\delta }{\sqrt{2}} \right) \end{equation}" style="width:257px; 
                            height:40px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.26</span>)</span></td>
</tr>
</table><p> と導かれる<a href="#a0000000059" class="footnote"><sup class="footnotemark">3</sup></a>。 </p><h4 id="a0000000060">方法1</h4>
<p> 生成量 </p><table id="a0000000061" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0038.png" alt="\begin{equation}  \pi _ d^{(t)} = g((\mu _1^{(t)},\mu _2^{(2)},\sigma ^{(t)}) = F \left( \frac{\delta ^{(t)}}{\sqrt{2}} \middle | \mu =0, \sigma =1 \right) \end{equation}" style="width:352px; 
                            height:41px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.27</span>)</span></td>
</tr>
</table><p> を利用して、優越率の事後分布を求める<a href="#a0000000062" class="footnote"><sup class="footnotemark">4</sup></a>。 </p><p>この生成量 <img src="images/img-0039.png" alt="$\pi _ d^{(t)}$" style="vertical-align:-5px; 
                                     width:24px; 
                                     height:22px" class="math gen" /> を利用すると、生成量が基準確率 <img src="images/img-0022.png" alt="$c$" style="vertical-align:0px; 
                                     width:7px; 
                                     height:7px" class="math gen" /> よりも大きい確率を、生成量 </p><table id="a0000000063" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0040.png" alt="\begin{equation}  u_{\pi _ d&gt;c}^{(t)} = g(\mu _1^{(t)},\mu _2^{(2)},\sigma ^{(t)}) = \begin{cases}  1~ ~ ~ ~ \pi _ d^{(t)} &gt; c \\ 0~ ~ ~ ~ \pi _ d^{(t)} \leq c \\ \end{cases} \end{equation}" style="width:301px; 
                            height:50px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.28</span>)</span></td>
</tr>
</table><p> のEAPにより評価することもできる。 </p><h4 id="a0000000064">方法2</h4>
<p> 事後予測分布を利用し、生成量 </p><table id="a0000000065" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0041.png" alt="\begin{equation}  u^{(t)}_{x_1^*-x_2^* &gt;0} = g(\mu _1^{(t)},\mu _2^{(2)},\sigma ^{(t)}) = \begin{cases}  1~ ~ ~ ~ x_1^*-x_2^* &gt;0\\ 0~ ~ ~ ~ x_1^*-x_2^* \leq 0 \end{cases} \end{equation}" style="width:356px; 
                            height:50px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.32</span>)</span></td>
</tr>
</table><p> のEAPを評価する<a href="#a0000000066" class="footnote"><sup class="footnotemark">5</sup></a>。 </p><h2 id="a0000000067">3.6 閾上率</h2>
<h4 id="a0000000068">閾上率（probability beyond threshold）</h4>
<p> 無作為に選んだ一方の群の測定値と他方の群の測定値の差が閾値 <img src="images/img-0022.png" alt="$c$" style="vertical-align:0px; 
                                     width:7px; 
                                     height:7px" class="math gen" /> を上回る確率。 </p><table id="a0000000069" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0042.png" alt="\begin{equation}  \pi _ c = p(x^*_1-x_2^* &gt; c) = p \left( z &lt; \frac{\mu _1-\mu _2-c}{\sqrt{2}\sigma } \right) \end{equation}" style="width:315px; 
                            height:40px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>3.35</span>)</span></td>
</tr>
</table><p> 優越率と同様、事後分布を直接評価、もしくは事後予測分布を通じて評価することができる。 </p><h2 id="a0000000070">3.8 標準偏差が異なるモデル</h2>
<p>2群の標準偏差を等しいという制約をおいた場合とおかなかった場合とでは、（いずれか片方の標準偏差を分母とした場合の）標準化された平均値差（効果量）と非重複度の値は食い違いが生じる。 一方、優越率および閾上率にはあまり影響を及ぼさない。 </p><div id="fig0307" class="figure"><center> 
<img src="images/img-0043.png" alt="\includegraphics[width=16cm]{fig0307.png}" style="width:16cm" /> <div class="caption"><b>Figure 3.2</b>: <span>標準偏差の等値制約と非重複度・優越率の変化</span></div>  </center></div><p>一般に、当該制約が適切である場合は、「制約のあるモデル」の方が、母数の事後標準偏差は小さくなる。 </p><h4 id="a0000000071">WAIC（Widely Applicable Information Criterion, or Watanabe Akaike Information Criterion）</h4>
<p> MCMCと相性の良い情報量規準。 将来のデータ <img src="images/img-0044.png" alt="$\bm@general \boldmath \m@ne \mv@bold \bm@command {x}^*$" style="vertical-align:0px; 
                                     width:16px; 
                                     height:12px" class="math gen" /> の予測の程度の指標で、WAICの小さなモデルを「良いモデル」とする<a href="#a0000000072" class="footnote"><sup class="footnotemark">6</sup></a>。 </p><h2 id="a0000000073">3.9 章末問題</h2>
<blockquote class="quote"><p> <span style="border: 1px solid black"><b class="bfseries">メモ</b></span> </p><p>95%片側確信区間を求めるために、90%両側確信区間の下側、上側を求めたい。stanでは上下2.5%、25%、50%点のみデフォルトで報告される。ここに5%を追加するにはどうしたらよいか？ </p><div style="text-align:right"> <span style="border: 1px solid black"><b class="bfseries">メモここまで</b></span> </div></blockquote><blockquote class="quote"><p> <span style="border: 1px solid black"><b class="bfseries">メモ</b></span> </p><p>P.81にあるように、母数の事前分布に一様分布 <img src="images/img-0045.png" alt="$U(0,100)$" style="vertical-align:-4px; 
                                     width:63px; 
                                     height:18px" class="math gen" /> などをstanで設定するにはどのようにしたらよいのだろう？ </p><div style="text-align:right"> <span style="border: 1px solid black"><b class="bfseries">メモここまで</b></span> </div></blockquote><h4 id="a0000000074">stanのコード</h4>
<p> <small class="small"><pre>
data{
  int&lt;lower=0&gt; n1;
  int&lt;lower=0&gt; n2;
  vector[1] x1[n1];
  vector[1] x2[n2];
}

parameters{
  real mu1;
  real mu2;
  real&lt;lower=1e-10&gt; sigma1;
  real&lt;lower=1e-10&gt; sigma2;
}

model{
  for(i in 1:n1){
    x1[i]~normal(mu1,sigma1);
  }
  for(i in 1:n2){
    x2[i]~normal(mu2,sigma2);
  }
}

generated quantities{
  real&lt;lower=0,upper=1&gt; p_mu1over2;    //[第1群の平均値&gt;第2群の平均値]である確率
  real                  diff_mu;       //第1群の平均値-第2群の平均値
  real                  delta;         //効果量（第2群のSDを分母とする）
  real&lt;lower=0,upper=1&gt; p_delta_overc; //効果量&gt;0.5となる確率
  real&lt;upper=1&gt;         u3;            //非重複率（第1群の平均が第2群の何%点か）
  real&lt;lower=0,upper=1&gt; p_u3_overc;    //非重複率&gt;0.8となる確率
  real&lt;upper=1&gt;         pd;            //優越率
  real&lt;lower=0,upper=1&gt; p_pd_overc;    //優越率&gt;0.8となる確率
  real&lt;upper=1&gt;         pbt;           //閾上率（閾値を5点とする）
  real&lt;lower=0,upper=1&gt; p_pbt_overc;   //閾上率&gt;0.8となる確率
  p_mu1over2    = step(mu1-mu2);
  diff_mu       = mu1-mu2;
  delta         = (mu1-mu2)/sigma2;
  p_delta_overc = step(delta-0.5);
  u3            = normal_cdf(mu1,mu2,sigma2);
  p_u3_overc    = step(u3-0.8);
  pd            = normal_cdf((mu1-mu2)/sqrt(pow(sigma1,2)+pow(sigma2,2)),0,1);
  p_pd_overc    = step(pd-0.8);
  pbt           = normal_cdf((mu1-mu2-5)/sqrt(pow(sigma1,2)+pow(sigma2,2)),0,1);
  p_pbt_overc   = step(pbt-0.8);
}

</pre> <span class="normalsize"></span></small></p><h4 id="a0000000075">Rのコード</h4>
<p> <small class="small"><pre>
x1&lt;-c(
  56,55,55,62,54,63,47,58,56,56,57,52,53,50,50,57,57,55,60,65,53,43,60,51,52,
  60,54,49,56,54,55,57,53,58,54,57,60,57,53,61,60,58,56,52,62,52,66,63,54,50)
x2&lt;-c(
  33,37,59,41,42,61,46,25,32,35,55,44,45,41,33,61,46,16,48,34,27,37,28,31,32,
  20,50,42,26,55,45,36,51,51,50,48,47,39,36,35,32,38,25,66,54,27,35,34,49,39)
n1&lt;-length(x1);n2&lt;-length(x2)
mean(x1);sd(x1);var(x1);summary(x1)
mean(x2);sd(x2);var(x2);summary(x2)
data01 &lt;- list(n1=n1,n2=n2,
               x1=structure(.Data=x1,.Dim=c(n1,1)),x2=structure(.Data=x2,.Dim=c(n2,1)))
scr &lt;- "toyoda2016-exer03.stan"
par &lt;- c("mu1","mu2","sigma1","sigma2","p_mu1over2","diff_mu",
         "delta","p_delta_overc","u3","p_u3_overc","pd","p_pd_overc","pbt","p_pbt_overc")
war &lt;- 1000
ite &lt;- 11000
see &lt;- 1234
dig &lt;- 3
cha &lt;- 4
fit01 &lt;- stan(file=scr,model_name=scr,data=data01,pars=par,verbose=F,seed=see,
              chains=cha,warmup=war,iter=ite)
print(fit01,pars=par,digits_summary=dig)
plot(fit01,pars=par)
traceplot(fit01,inc_warmup=T,pars=par)
</pre> <span class="normalsize"></span></small></p><h4 id="a0000000076">実行結果</h4>
<p> <small class="small"><pre>
                mean se_mean    sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
mu1           55.761   0.003 0.671 54.452 55.314 55.760 56.206 57.090 40000    1
mu2           40.378   0.008 1.624 37.176 39.299 40.373 41.452 43.584 40000    1
sigma1         4.699   0.002 0.493  3.853  4.352  4.659  5.002  5.778 40000    1
sigma2        11.443   0.006 1.194  9.387 10.600 11.347 12.184 14.045 40000    1
p_mu1over2     1.000   0.000 0.000  1.000  1.000  1.000  1.000  1.000 40000  NaN
diff_mu       15.383   0.009 1.758 11.939 14.212 15.386 16.544 18.844 40000    1
delta          1.359   0.001 0.208  0.960  1.218  1.356  1.496  1.775 40000    1
p_delta_overc  1.000   0.000 0.005  1.000  1.000  1.000  1.000  1.000 40000    1
u3             0.908   0.000 0.034  0.831  0.888  0.912  0.933  0.962 40000    1
p_u3_overc     0.995   0.000 0.073  1.000  1.000  1.000  1.000  1.000 35283    1
pd             0.891   0.000 0.033  0.816  0.871  0.895  0.915  0.946 40000    1
p_pd_overc     0.989   0.001 0.104  1.000  1.000  1.000  1.000  1.000 32356    1
pbt            0.798   0.000 0.045  0.703  0.770  0.801  0.829  0.877 40000    1
p_pbt_overc    0.508   0.002 0.500  0.000  0.000  1.000  1.000  1.000 40000    1
</pre> <span class="normalsize"></span></small></p></div>

<div id="footnotes">
<p><b>Footnotes</b></p>
<ol>
<li id="a0000000051">平均値の大きい方を第1群とする。</li><li id="a0000000053">正規分布の場合。</li><li id="a0000000059"><img src="images/img-0046.png" alt="$z \sim N(0,1)$" style="vertical-align:-4px; 
                                     width:81px; 
                                     height:18px" class="math gen" /></li><li id="a0000000062">平均、SD、確信区間が求まる。</li><li id="a0000000066">点推定値しか得られない。</li><li id="a0000000072">Watanebe (2009; 2010)</li>
</ol>
</div>

<div class="navigation">
<div class="online-navigation">
<hr />
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class="online-navigation"><a title="2 MCMCと正規分布の推測" href="sect0002.html" rel="prev"><img src="icons/previous.png" border="0" height="32" alt="Previous Page" width="32" /></a></td>
<td class="online-navigation"><a title="はじめての統計データ分析" href="index.html" rel="parent"><img src="icons/up.png" border="0" height="32" alt="Up One Level" width="32" /></a></td>
<td class="online-navigation"><a title="対応のある2群のデータ" href="sect0004.html" rel="next"><img src="icons/next.png" border="0" height="32" alt="Next Page" width="32" /></a></td>
<td align="center" width="100%">はじめての統計データ分析</td>
<td class="online-navigation"><a href="index.html" rel="contents" title="Table of Contents"><img src="icons/contents.png" border="0" height="32" alt="Contents" width="32" /></a></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" alt="" width="32" /></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" width="32" /></td>
</tr></table>
<div class="online-navigation">
<span><b class="navlabel">Previous:</b>
<a href="sect0002.html" class="sectref" rel="prev">MCMCと正規分布の推測</a></span>
<span><b class="navlabel">Up:</b>
<a href="index.html" class="sectref" rel="parent">はじめての統計データ分析</a></span>
<span><b class="navlabel">Next:</b>
<a href="sect0004.html" class="sectref" rel="next">対応のある2群のデータ</a></span>
</div>
</div>
<hr />
<!--
<span class="release-info">Release 2.4.3, documentation updated on 29 March 2006.</span>
-->
</div>
<!--End of Navigation Panel-->
<!--
<address>
See <i><a href="about.html">About this document...</a></i> for information on suggesting changes.
</address>
-->
</body>
</html>