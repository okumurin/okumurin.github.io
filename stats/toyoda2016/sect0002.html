<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="shortcut icon" href="icons/pyfav.png" type="image/png" />
<link href="index.html" title="はじめての統計データ分析" rel="start" />
<link href="index.html" title="はじめての統計データ分析" rel="first" />
<link href="index.html" rel="contents" title="Contents" />
<link rel="index" title="Index" />
<link href="sect0003.html" rel="next" />
<link href="sect0001.html" rel="prev" />
<link href="index.html" rel="parent" />
<meta name="aesop" content="information" />
<title>2 MCMCと正規分布の推測</title>
</head>
<body>
<div class="navigation">
<div id="top-navigation-panel" xml:id="top-navigation-panel">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class="online-navigation"><a title="1 データの整理とベイズの定理" href="sect0001.html" rel="prev"><img src="icons/previous.png" border="0" height="32" alt="Previous Page" width="32" /></a></td>
<td class="online-navigation"><a title="はじめての統計データ分析" href="index.html" rel="parent"><img src="icons/up.png" border="0" height="32" alt="Up One Level" width="32" /></a></td>
<td class="online-navigation"><a title="独立した2群の差の推測" href="sect0003.html" rel="next"><img src="icons/next.png" border="0" height="32" alt="Next Page" width="32" /></a></td>
<td align="center" width="100%">はじめての統計データ分析</td>
<td class="online-navigation"><a href="index.html" rel="contents" title="Table of Contents"><img src="icons/contents.png" border="0" height="32" alt="Contents" width="32" /></a></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" alt="" width="32" /></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" width="32" /></td>
</tr></table>
<div class="online-navigation">
<span><b class="navlabel">Previous:</b>
<a href="sect0001.html" class="sectref" rel="prev">データの整理とベイズの定理</a></span>
<span><b class="navlabel">Up:</b>
<a href="index.html" class="sectref" rel="parent">はじめての統計データ分析</a></span>
<span><b class="navlabel">Next:</b>
<a href="sect0003.html" class="sectref" rel="next">独立した2群の差の推測</a></span>
</div>
<hr /></div>
</div>



<div><h1 id="a0000000003">2 MCMCと正規分布の推測</h1>
<h2 id="a0000000013">2.1 マルコフ連鎖モンテカルロ法</h2>
<h3 id="a0000000014">2.1.2 事前分布の設定</h3>
<ul class="itemize">
<li><p>Gibbs sampling（GS法）：特定の母数には特定の事前分布の型を指定する必要がある。 </p></li><li><p>ハミルトニアンモンテカルロ（HMC）法：分析者が自分の意思で自由な事前分布を選ぶことができる。 </p></li>
</ul><h3 id="a0000000015">2.1.5 乱数列の数値的評価</h3>
<h4 id="a0000000016">有効標本数<img src="images/img-0003.png" alt="$n_{\textit{eff}}$" style="vertical-align:-5px; 
                                     width:26px; 
                                     height:12px" class="math gen" /></h4>
<p>発生させた乱数が理想的な乱数のいくつ分に相当するか<a href="#a0000000017" class="footnote"><sup class="footnotemark">1</sup></a>。 標準誤差を算出する際に用いる。 </p><h4 id="a0000000018">収束判定指標<img src="images/img-0004.png" alt="$\hat{R}$" style="vertical-align:0px; 
                                     width:13px; 
                                     height:17px" class="math gen" /></h4>
<p>チェイン間と内の散らばりを比較することで、事後分布から乱数を発生させているかを判定する指標。 </p><div id="tab2-1" class="table"> <div class="caption"><b>Table 2.1</b>: <span>「牛丼問題」の乱数列の評価</span></div> <center> <table class="tabular" cellspacing="0">
<tr>

    
    <td style="border-top-style:solid; border-left:1px solid black; border-right:1px solid black; border-top-color:black; border-top-width:1px; text-align:center">&nbsp;</td>

    
    <td style="border-top-style:solid; border-top-color:black; border-top-width:1px; text-align:center"><p> 　<img src="images/img-0003.png" alt="$n_{\textit{eff}}$" style="vertical-align:-5px; 
                                     width:26px; 
                                     height:12px" class="math gen" />　 </p></td>

    
    <td style="border-top-style:solid; text-align:center; border-top-color:black; border-top-width:1px; border-right:1px solid black"><p> 　<img src="images/img-0004.png" alt="$\hat{R}$" style="vertical-align:0px; 
                                     width:13px; 
                                     height:17px" class="math gen" /> 　</p></td>

</tr><tr>

    
    <td style="border-top-style:solid; border-left:1px solid black; border-right:1px solid black; border-top-color:black; border-top-width:1px; text-align:center"><p>　<img src="images/img-0005.png" alt="$\mu $" style="vertical-align:-3px; 
                                     width:10px; 
                                     height:10px" class="math gen" /> 　</p></td>

    
    <td style="border-top-style:solid; border-top-color:black; border-top-width:1px; text-align:center"><p> 　<img src="images/img-0006.png" alt="$32600$" style="vertical-align:0px; 
                                     width:40px; 
                                     height:12px" class="math gen" />　 </p></td>

    
    <td style="border-top-style:solid; text-align:center; border-top-color:black; border-top-width:1px; border-right:1px solid black"><p> 　<img src="images/img-0007.png" alt="$1.00$" style="vertical-align:0px; 
                                     width:28px; 
                                     height:12px" class="math gen" />　 </p></td>

</tr><tr>

    
    <td style="border-bottom-style:solid; border-bottom-width:1px; border-left:1px solid black; border-right:1px solid black; text-align:center; border-bottom-color:black"><p>　<img src="images/img-0008.png" alt="$\sigma $" style="vertical-align:0px; 
                                     width:10px; 
                                     height:7px" class="math gen" /> 　</p></td>

    
    <td style="border-bottom-width:1px; border-bottom-color:black; border-bottom-style:solid; text-align:center"><p> 　<img src="images/img-0009.png" alt="$29714$" style="vertical-align:0px; 
                                     width:40px; 
                                     height:13px" class="math gen" />　 </p></td>

    
    <td style="border-bottom-color:black; border-bottom-width:1px; text-align:center; border-bottom-style:solid; border-right:1px solid black"><p>　 <img src="images/img-0007.png" alt="$1.00$" style="vertical-align:0px; 
                                     width:28px; 
                                     height:12px" class="math gen" />　 </p></td>

</tr>
</table> </center>  </div><h2 id="a0000000019">2.2 事後分布</h2>
<h3 id="a0000000020">2.2.2 事後分散・事後標準偏差</h3>
<h4 id="a0000000021">事後標準偏差</h4>
<p> <img src="images/img-0010.png" alt="$\theta $" style="vertical-align:0px; 
                                     width:8px; 
                                     height:11px" class="math gen" /> の標準偏差。 母数 <img src="images/img-0010.png" alt="$\theta $" style="vertical-align:0px; 
                                     width:8px; 
                                     height:11px" class="math gen" /> が <img src="images/img-0011.png" alt="$\hat{\theta }_{\textit{eap}}$" style="vertical-align:-5px; 
                                     width:27px; 
                                     height:22px" class="math gen" /> の周辺でどれほど散らばっているか。 <img src="images/img-0012.png" alt="$n$" style="vertical-align:0px; 
                                     width:10px; 
                                     height:7px" class="math gen" /> に依存して値が決まる。 </p><h3 id="a0000000022">2.2.3 事後期待値の標準誤差</h3>
<h4 id="a0000000023">標準誤差</h4>
<p><img src="images/img-0011.png" alt="$\hat{\theta }_{\textit{eap}}$" style="vertical-align:-5px; 
                                     width:27px; 
                                     height:22px" class="math gen" /> の標準偏差。乱数の数 <img src="images/img-0013.png" alt="$T$" style="vertical-align:0px; 
                                     width:12px; 
                                     height:11px" class="math gen" /> に依存して値が決まる。 </p><table id="a0000000024" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0014.png" alt="\begin{equation}  \hat{\theta }_{\textit{eap}} \sim N(\theta _{\textit{eqp}}, \sigma _{\theta }/\sqrt{n_{\textit{eff}}}) = N(\theta _{\textit{eqp}}, \sigma _{\hat{\theta }_\textit {eqp}}) \end{equation}" style="width:293px; 
                            height:26px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.9</span>)</span></td>
</tr>
</table><h2 id="a0000000025">2.4 母数と予測分布に関するベイズ的推測</h2>
<h4 id="a0000000026">実質科学的知見</h4>
<p> 統計学とは全く関係のない知見（<b class="bfseries">固有技術、ドメイン知識</b>） </p><p>何らかの基準点を設定する場合、実質科学的知見からの要請にもとづく場合が多い。 </p><h2 id="a0000000027">2.5 生成量</h2>
<h4 id="a0000000028">生成量</h4>
<p> MCMC法による標本 <img src="images/img-0015.png" alt="$\bm@general \boldmath \m@ne \mv@bold \bm@command {\theta }^{(t)}$" style="vertical-align:0px; 
                                     width:23px; 
                                     height:16px" class="math gen" /> の関数 <img src="images/img-0016.png" alt="$g(\bm@general \boldmath \m@ne \mv@bold \bm@command {\theta }^{(t)})$" style="vertical-align:-4px; 
                                     width:45px; 
                                     height:20px" class="math gen" /> 。 </p><h3 id="a0000000029">2.5.1 分散</h3>
<table id="a0000000030" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0017.png" alt="\begin{equation}  g(\sigma ^{(t)}) = \sigma ^{(t)2} \end{equation}" style="width:101px; 
                            height:19px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.20</span>)</span></td>
</tr>
</table><blockquote class="quote"><p> <span style="border: 1px solid black"><b class="bfseries">メモ</b></span> </p><p>生成量としてではなく、最初から分散を母数としてはダメなのか？ （本文では、正規分布の母数にも分散ではなく標準偏差が用いられている。） </p><div style="text-align:right"> <span style="border: 1px solid black"><b class="bfseries">メモここまで</b></span> </div></blockquote><h3 id="a0000000031">2.5.2 変動係数</h3>
<p>測定値が比尺度である場合の散布度の指標<a href="#a0000000032" class="footnote"><sup class="footnotemark">2</sup></a>。 </p><table id="a0000000033" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0018.png" alt="\begin{equation}  g(\mu ^{(t)},\sigma ^{(t)}) = \frac{\sigma ^{(t)}}{\mu ^{(t)}} \end{equation}" style="width:132px; 
                            height:40px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.24</span>)</span></td>
</tr>
</table><blockquote class="quote"><p> <span style="border: 1px solid black"><b class="bfseries">メモ</b></span> </p><p>このように複数の母数が組み合わさった生成量については、<img src="images/img-0019.png" alt="$\mu ^{(t)}$" style="vertical-align:-3px; 
                                     width:24px; 
                                     height:17px" class="math gen" /> と <img src="images/img-0020.png" alt="$\sigma ^{(t)}$" style="vertical-align:0px; 
                                     width:24px; 
                                     height:14px" class="math gen" /> が同時分布からの標本 <img src="images/img-0015.png" alt="$\bm@general \boldmath \m@ne \mv@bold \bm@command {\theta }^{(t)}$" style="vertical-align:0px; 
                                     width:23px; 
                                     height:16px" class="math gen" /> として得られている場合にのみ意味がある。 例えば、Gibbs sampling のように母数ごとの周辺分布からの標本しか得られない場合は、このような生成量を構成しても無意味である（と思う）。 </p><div style="text-align:right"> <span style="border: 1px solid black"><b class="bfseries">メモここまで</b></span> </div></blockquote><h3 id="a0000000034">2.5.3 効果量</h3>
<table id="a0000000035" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0021.png" alt="\begin{equation}  \delta _ c^{(t)} = g(\mu ^{(t)},\sigma ^{(t)}) = \frac{\mu ^{(t)} - c}{\sigma ^{(t)}} \end{equation}" style="width:206px; 
                            height:37px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.26</span>)</span></td>
</tr>
</table><p>ちなみに、定数 <img src="images/img-0022.png" alt="$c$" style="vertical-align:0px; 
                                     width:7px; 
                                     height:7px" class="math gen" /> を変化させた場合の効果量の事後分布は単純に平行移動したものにならないので注意。 </p><h3 id="a0000000036">2.5.4 分位点・%点</h3>
<p>モデル分布が正規分布のように既知である場合、予測値 <img src="images/img-0023.png" alt="$x^*$" style="vertical-align:0px; 
                                     width:15px; 
                                     height:12px" class="math gen" /> の%点の事後分布を </p><table id="a0000000037" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0024.png" alt="\begin{equation}  g(\mu ^{(t)},\sigma ^{(t)}) = \mu ^{(t)} + z \times \sigma ^{(t)} \end{equation}" style="width:203px; 
                            height:19px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.27</span>)</span></td>
</tr>
</table><p> のように求めることができる<a href="#a0000000038" class="footnote"><sup class="footnotemark">3</sup></a>。 </p><h3 id="a0000000039">2.5.5 予測分布の特定区間の確率</h3>
<p>将来のデータが区間 <img src="images/img-0025.png" alt="$[ a,b ]$" style="vertical-align:-5px; 
                                     width:28px; 
                                     height:18px" class="math gen" /> に観察される予測確率 </p><table id="a0000000040" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0026.png" alt="\begin{equation}  p_{ab} = F(b|\bm@general \boldmath \m@ne \mv@bold \bm@command {x}) - F(a|\bm@general \boldmath \m@ne \mv@bold \bm@command {x}) \end{equation}" style="width:161px; 
                            height:18px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.28</span>)</span></td>
</tr>
</table><p> の事後分布を、生成量 </p><table id="a0000000041" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0027.png" alt="\begin{equation}  g(\mu ^{(t)},\sigma ^{(t)}) = F(b | \mu ^{(t)},\sigma ^{(t)}) - F(a | \mu ^{(t)},\sigma ^{(t)}) \end{equation}" style="width:319px; 
                            height:19px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.29</span>)</span></td>
</tr>
</table><p> で求める。 </p><h4 id="a0000000042">事後予測分布と条件付き予測分布</h4>
<ul class="itemize">
<li><p>事後予測分布：%点は推定値（1つだけ）としてしか評価できない </p></li><li><p>条件付き予測分布：%点は分布として評価できる </p></li>
</ul><blockquote class="quote"><p> <span style="border: 1px solid black"><b class="bfseries">メモ</b></span> </p><p>一般に、事後予測分布は既知の分布になるとは限らない。 一方、条件付き予測分布であれば、母数の候補値を所与とした既知のモデル分布になる。 </p><div style="text-align:right"> <span style="border: 1px solid black"><b class="bfseries">メモここまで</b></span> </div></blockquote><h3 id="a0000000043">2.5.6 基準点との比</h3>
<table id="a0000000044" class="equation" width="100%" cellspacing="0" cellpadding="7">
<tr>
    
    <td style="width:40%">&nbsp;</td>
    <td><img src="images/img-0028.png" alt="\begin{equation}  g(x^{*(t)}) = x^{*(t)} / c \end{equation}" style="width:123px; 
                            height:19px" class="math gen" /></td>
    
    <td style="width:40%">&nbsp;</td>
    <td class="eqnnum" style="width:20%"><span>(<span>2.30</span>)</span></td>
</tr>
</table><h2 id="a0000000045">2.8 章末問題</h2>
<h4 id="a0000000046">stanのコード</h4>
<p> <small class="small"><pre>
data {
  int&lt;lower=0&gt; N;
  vector&lt;lower=0&gt;[1] x[N];
}

parameters {
  real mu;
  real&lt;lower=0&gt; sigma;
}

model{
  for(i in 1:N){
  x[i] ~ normal(mu,sigma);
  }
}

generated quantities{
  real&lt;lower=0&gt; sigmasq; //分散
  real x_star;  //予測値
  real cv;      //変動係数
  real delta_35;   //効果量（基準値c=35）
  real&lt;lower=0,upper=1&gt; px_under35_1; //35点未満の値が観測される事後予測確率
  real rto_35; //基準点(c=35)との比
  real&lt;lower=0,upper=1&gt; pmu_under35; //母平均が35点未満の確率
  real&lt;lower=0,upper=1&gt; px_under35_2; //35点未満の値が観測される事後予測確率
  real&lt;lower=0,upper=1&gt; pdelta_under1; //効果量が1.0未満である確率
  real&lt;lower=0,upper=1&gt; px_under35_over90; //35点未満の値が観測される確率が90%以上の確率
  sigmasq = pow(sigma,2);
  x_star = normal_rng(mu,sigma);
  cv = sigma/mu;
  delta_35 = (mu-35)/sigma;
  px_under35_1 = normal_cdf(35,mu,sigma);
  rto_35 = x_star/35;
  pmu_under35 = mu&lt;35 ? 1:0;
  px_under35_2 = x_star&lt;35 ? 1:0;
  pdelta_under1 = delta_35&lt;1.0 ? 1:0;
  px_under35_over90 = px_under35_1&gt;0.9 ? 1:0;
}
</pre> <span class="normalsize"></span></small></p><h4 id="a0000000047">Rのコード</h4>
<p> <small class="small"><pre>
library("rstan")
# 第2章
# 章末問題
N &lt;- 100
x &lt;-  structure(.Data=c(
  36,38,51,40,41,52,43,31,35,37,49,43,43,41,36,53,43,26,45,37,
  33,38,33,35,36,28,46,41,32,49,43,38,46,46,46,45,44,40,38,37,
  35,39,31,55,48,32,37,37,45,39,42,40,40,50,38,51,29,44,41,42,
  43,36,38,33,32,42,43,40,46,54,37,24,47,35,35,47,38,31,41,39,
  40,43,37,45,38,42,48,43,38,48,47,44,42,36,50,36,55,51,38,33),.Dim=c(100,1))
data01 &lt;- list(N=N,x=x)
scr &lt;- "toyoda2016-exer02.stan"
par &lt;- c("mu","sigma","sigmasq","x_star","cv","delta_35","px_under35_1","rto_35",
         "pmu_under35","px_under35_2","pdelta_under1","px_under35_over90")
war &lt;- 5000
ite &lt;- 105000
see &lt;- 1234
dig &lt;- 3
cha &lt;- 4
fit01 &lt;- stan(file=scr,model_name=scr,data=data01,pars=par,verbose=F,seed=see,
              chains=cha,warmup=war,iter=ite)
print(fit01,pars=par,digits_summary=dig)
plot(fit01,pars=par)
traceplot(fit01,inc_warmup=T,pars=par)
</pre> <span class="normalsize"></span></small></p><h4 id="a0000000048">実行結果</h4>
<p> <small class="small"><pre>
                    mean se_mean    sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
mu                40.643   0.004 0.650 39.368 40.206 40.642 41.083 41.919 34081    1
sigma              6.509   0.003 0.467  5.675  6.185  6.480  6.804  7.501 31680    1
sigmasq           42.584   0.035 6.158 32.210 38.252 41.993 46.289 56.270 31548    1
x_star            40.608   0.033 6.552 27.781 36.180 40.581 45.042 53.493 40000    1
cv                 0.160   0.000 0.012  0.139  0.152  0.159  0.168  0.185 32226    1
delta_35           0.871   0.001 0.117  0.644  0.793  0.871  0.950  1.101 34035    1
px_under35_1       0.193   0.000 0.032  0.136  0.171  0.192  0.214  0.260 33600    1
rto_35             1.160   0.001 0.187  0.794  1.034  1.159  1.287  1.528 40000    1
pmu_under35        0.000   0.000 0.000  0.000  0.000  0.000  0.000  0.000 40000  NaN
px_under35_2       0.195   0.002 0.396  0.000  0.000  0.000  0.000  1.000 40000    1
pdelta_under1      0.864   0.002 0.343  0.000  1.000  1.000  1.000  1.000 27626    1
px_under35_over90  0.000   0.000 0.000  0.000  0.000  0.000  0.000  0.000 40000  NaN
</pre> <span class="normalsize"></span></small></p></div>

<div id="footnotes">
<p><b>Footnotes</b></p>
<ol>
<li id="a0000000017">MCMCで発生させる乱数は系列相関を有する。</li><li id="a0000000032">原点が固定されていないと、意味をなさない。</li><li id="a0000000038">予測分布の%点の事後分布なので、メタ分布。気象庁が降水確率に確信度ABCを付帯させているという例が提示されている。</li>
</ol>
</div>

<div class="navigation">
<div class="online-navigation">
<hr />
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td class="online-navigation"><a title="1 データの整理とベイズの定理" href="sect0001.html" rel="prev"><img src="icons/previous.png" border="0" height="32" alt="Previous Page" width="32" /></a></td>
<td class="online-navigation"><a title="はじめての統計データ分析" href="index.html" rel="parent"><img src="icons/up.png" border="0" height="32" alt="Up One Level" width="32" /></a></td>
<td class="online-navigation"><a title="独立した2群の差の推測" href="sect0003.html" rel="next"><img src="icons/next.png" border="0" height="32" alt="Next Page" width="32" /></a></td>
<td align="center" width="100%">はじめての統計データ分析</td>
<td class="online-navigation"><a href="index.html" rel="contents" title="Table of Contents"><img src="icons/contents.png" border="0" height="32" alt="Contents" width="32" /></a></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" alt="" width="32" /></td>
<td class="online-navigation"><img src="icons/blank.png" border="0" height="32" width="32" /></td>
</tr></table>
<div class="online-navigation">
<span><b class="navlabel">Previous:</b>
<a href="sect0001.html" class="sectref" rel="prev">データの整理とベイズの定理</a></span>
<span><b class="navlabel">Up:</b>
<a href="index.html" class="sectref" rel="parent">はじめての統計データ分析</a></span>
<span><b class="navlabel">Next:</b>
<a href="sect0003.html" class="sectref" rel="next">独立した2群の差の推測</a></span>
</div>
</div>
<hr />
<!--
<span class="release-info">Release 2.4.3, documentation updated on 29 March 2006.</span>
-->
</div>
<!--End of Navigation Panel-->
<!--
<address>
See <i><a href="about.html">About this document...</a></i> for information on suggesting changes.
</address>
-->
</body>
</html>