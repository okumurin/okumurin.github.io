<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with jLaTeX2HTML 2016 (1.71) JA patch-2.1beta1.16
patched version by:  Kenshi Muto, Debian Project.
* modified by:  Shige TAKENO
LaTeX2HTML 2016 (1.71),
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<META NAME="Generator" CONTENT="jLaTeX2HTML v2016 JA patch-2.1beta1.16">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
<META NAME="description" CONTENT="依存性をモデル化する相関構造">
<META NAME="keywords" CONTENT="piheiro_bates2000">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<LINK REL="STYLESHEET" HREF="piheiro_bates2000.css">

<LINK REL="previous" HREF="node16.html">
<LINK REL="up" HREF="node14.html">
<TITLE>依存性をモデル化する相関構造</TITLE>

</HEAD>

<BODY >

<DIV CLASS="navigation">
<IMG WIDTH="81" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next_inactive" SRC="nx_grp_g.png"> 
<A NAME="tex2html205"
  HREF="node14.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html203"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   <BR>
<B>Up:</B> <A NAME="tex2html206"
  HREF="node14.html">基本的な線形混合効果モデルの拡張</A>
<B> Previous:</B> <A NAME="tex2html204"
  HREF="node16.html">不等分散性をモデル化するための分散関数</A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><A NAME="tex2html207"
  HREF="node17.html#SECTION00053010000000000000">相関構造</A>
</UL>
<BR>
<LI><A NAME="tex2html208"
  HREF="node17.html#SECTION00053100000000000000">系列相関構造</A>
<UL>
<LI><A NAME="tex2html209"
  HREF="node17.html#SECTION00053110000000000000">複合対称</A>
<LI><A NAME="tex2html210"
  HREF="node17.html#SECTION00053120000000000000">一般化</A>
<LI><A NAME="tex2html211"
  HREF="node17.html#SECTION00053130000000000000">自己回帰-移動平均</A>
</UL>
<BR>
<LI><A NAME="tex2html212"
  HREF="node17.html#SECTION00053200000000000000"><TT>nlme</TT>における相関構造：<TT>corStruct</TT>クラス</A>
<UL>
<LI><A NAME="tex2html213"
  HREF="node17.html#SECTION00053210000000000000">corCompSymm</A>
<LI><A NAME="tex2html214"
  HREF="node17.html#SECTION00053220000000000000">corSymm</A>
<LI><A NAME="tex2html215"
  HREF="node17.html#SECTION00053230000000000000">corAR1</A>
<LI><A NAME="tex2html216"
  HREF="node17.html#SECTION00053240000000000000">corARMA</A>
</UL>
<BR>
<LI><A NAME="tex2html217"
  HREF="node17.html#SECTION00053300000000000000"><TT>lme</TT>による相関構造の使用</A>
<UL>
<LI><A NAME="tex2html218"
  HREF="node17.html#SECTION00053310000000000000">相関モデルの妥当性評価</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00053000000000000000">
依存性をモデル化する相関構造</A>
</H2>

<P>

<H4><A NAME="SECTION00053010000000000000">
相関構造</A>
</H4>
グループ内誤差の依存性をモデル化するのに使用される。

<P>
グループ内誤差 <!-- MATH
 $\epsilon_{ij}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img40.png"
 ALT="$ \epsilon_{ij}$"></SPAN>
<!-- MATHEND
 
 -->
 が位置ベクトル <!-- MATH
 $\bm{p}_{ij}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="25" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img41.png"
 ALT="$ \bm{p}_{ij}$"></SPAN>
<!-- MATHEND
 
 -->
 に関係すると仮定する。

<P>
相関構造は<SPAN  CLASS="textbf">等方的</SPAN> <SPAN  CLASS="textit">isotropic</SPAN> であると仮定する。

<P>
相関パラメータを <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img42.png"
 ALT="$ \bm{\rho}$"></SPAN>
<!-- MATHEND
 
 -->
 として，
<P><!-- MATH
 \begin{displaymath}
\mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = h [d(\bm{p}_{ij}, \bm{p}_{ij'}), \bm{\rho}]
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="214" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img43.png"
 ALT="$\displaystyle \mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = h [d(\bm{p}_{ij}, \bm{p}_{ij'}), \bm{\rho}]$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>
と表現する。

<P>

<H3><A NAME="SECTION00053100000000000000">
系列相関構造</A>
</H3>

<P>
自己相関関数 <SPAN CLASS="MATH"><IMG
 WIDTH="30" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img44.png"
 ALT="$ h(\cdot)$"></SPAN>
<!-- MATHEND
 
 -->
 として
<P><!-- MATH
 \begin{displaymath}
\mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = h (|p_{ij}-p_{ij'}|, \bm{\rho})
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="215" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img45.png"
 ALT="$\displaystyle \mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = h (\vert p_{ij}-p_{ij'}\vert, \bm{\rho})$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>
と定義する。

<P>

<H4><A NAME="SECTION00053110000000000000">
複合対称</A>
</H4>

<P>
同じ群に属するすべてのグループ内誤差中の等しい相関性を仮定。

<P>
<P><!-- MATH
 \begin{displaymath}
\mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = \rho, ~~~\forall j \neq j', ~~~ h(k,\rho)=\rho ~~~~(k=1,2,\dots)
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="399" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img46.png"
 ALT="$\displaystyle \mathrm{cor} (\epsilon_{ij}, \epsilon_{ij'}) = \rho,&nbsp;&nbsp;&nbsp;\forall j \neq j',&nbsp;&nbsp;&nbsp; h(k,\rho)=\rho&nbsp;&nbsp;&nbsp;&nbsp;(k=1,2,\dots)$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>
<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img47.png"
 ALT="$ \rho$"></SPAN>
<!-- MATHEND
 
 -->
 を<SPAN  CLASS="textbf">級内相関係数</SPAN>という。

<P>
<DIV STYLE="border: inset blue; background-color: white">
分散 <SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="17" ALIGN="BOTTOM" BORDER="0"
 SRC="img48.png"
 ALT="$ \sigma^2$"></SPAN>
<!-- MATHEND
 
 -->
 の独立同分布の誤差および分散 <!-- MATH
 $\sigma^2_b$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img49.png"
 ALT="$ \sigma^2_b$"></SPAN>
<!-- MATHEND
 
 -->
 の単一切片の変量効果を持つシングルレベルの線形混合効果モデルでは

<UL>
<LI>分散共分散行列：<!-- MATH
 $\sigma^2 \bm{I} + \sigma^2_b \bm{1} \bm{1}^T$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="95" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img50.png"
 ALT="$ \sigma^2 \bm{I} + \sigma^2_b \bm{1} \bm{1}^T$"></SPAN>
<!-- MATHEND
 
 -->
</LI>
<LI>相関行列：<!-- MATH
 $\sigma^2/(\sigma^2_b + \sigma^2) \bm{I} + \sigma^2_b/(\sigma^2_b+\sigma^2) \bm{1} \bm{1}^T$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="242" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img51.png"
 ALT="$ \sigma^2/(\sigma^2_b + \sigma^2) \bm{I} + \sigma^2_b/(\sigma^2_b+\sigma^2) \bm{1} \bm{1}^T$"></SPAN>
<!-- MATHEND
 
 -->
</LI>
</UL>
となり，級内相関 <!-- MATH
 $\rho = \sigma^2_b /(\sigma_b^2 + \sigma^2)$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="124" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img52.png"
 ALT="$ \rho = \sigma^2_b /(\sigma_b^2 + \sigma^2)$"></SPAN>
<!-- MATHEND
 
 -->
 をもつ複合対称構造と同等
この場合は <!-- MATH
 $0 \leq \rho \leq 1$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="71" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img53.png"
 ALT="$ 0 \leq \rho \leq 1$"></SPAN>
<!-- MATHEND
 
 -->
 という制約がある。

<P>
上記のモデルでは，<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img47.png"
 ALT="$ \rho$"></SPAN>
<!-- MATHEND
 
 -->
 は正定値であれば負でもよい。
</DIV>

<P>
時系列データに対しては，複合対称相関モデルは制約がきつすぎる。

<P>

<H4><A NAME="SECTION00053120000000000000">
一般化</A>
</H4>

<P>
相関はすべて異なるパラメータとなる。複合対象に対してパラメータが過剰。

<P>
<P><!-- MATH
 \begin{displaymath}
h(k, \bm{\rho}) = \rho_k
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="89" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img54.png"
 ALT="$\displaystyle h(k, \bm{\rho}) = \rho_k$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>

<H4><A NAME="SECTION00053130000000000000">
自己回帰-移動平均</A>
</H4>

<P>
<SPAN  CLASS="textbf">Box-Jenkins モデル</SPAN>とも。

<P>

<H5><A NAME="SECTION00053131000000000000">
自己回帰モデル</A>
</H5>

<P>
等分散のノイズ項 <SPAN CLASS="MATH"><IMG
 WIDTH="18" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img55.png"
 ALT="$ a_t$"></SPAN>
<!-- MATHEND
 
 -->
（<!-- MATH
 $E[a_t] = 0$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="69" HEIGHT="31" ALIGN="MIDDLE" BORDER="0"
 SRC="img56.png"
 ALT="$ E[a_t] = 0$"></SPAN>
<!-- MATHEND
 
 -->
）を用いて，
次数 <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img57.png"
 ALT="$ p$"></SPAN>
<!-- MATHEND
 
 -->
 の自己回帰モデル <SPAN  CLASS="textit">AR</SPAN>(<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img57.png"
 ALT="$ p$"></SPAN>
<!-- MATHEND
 
 -->
)：

<P>
<P><!-- MATH
 \begin{displaymath}
\epsilon_t = \phi_1 \epsilon_{t-1} + \dots + \phi_p \epsilon_{t-p} + a_t
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="219" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img58.png"
 ALT="$\displaystyle \epsilon_t = \phi_1 \epsilon_{t-1} + \dots + \phi_p \epsilon_{t-p} + a_t$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>
<SPAN  CLASS="textit">AR</SPAN>(1) モデル：

<P>
<P><!-- MATH
 \begin{displaymath}
h(k, \phi) = \phi^k
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="90" HEIGHT="36" ALIGN="MIDDLE" BORDER="0"
 SRC="img59.png"
 ALT="$\displaystyle h(k, \phi) = \phi^k$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>

<H5><A NAME="SECTION00053132000000000000">
移動平均相関モデル</A>
</H5>

<P>
<P><!-- MATH
 \begin{displaymath}
\epsilon_t = \theta_1 a_{t-1} + \dots + \theta_q a_{t-q} + a_t
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="218" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img60.png"
 ALT="$\displaystyle \epsilon_t = \theta_1 a_{t-1} + \dots + \theta_q a_{t-q} + a_t$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>
<SPAN  CLASS="textit">MA</SPAN>(<SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img61.png"
 ALT="$ q$"></SPAN>
<!-- MATHEND
 
 -->
) モデルに対する相関関数は
<P><!-- MATH
 \begin{displaymath}
h(k, \bm{\theta}) =
\begin{cases}
\cfrac{\theta_k + \theta_1 \theta_{k-1} + \dots + \theta_{k-q} \theta_q}{1+\theta_1^2+\dots+\theta_q^2}~~~(k=1,\dots, q) \\
0~~~~(k=q+1, q+2, \dots)
\end{cases}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="375" HEIGHT="92" BORDER="0"
 SRC="img62.png"
 ALT="\begin{displaymath}h(k, \bm{\theta}) =
\begin{cases}
\cfrac{\theta_k + \theta_1...
..._q^2}&nbsp;&nbsp;&nbsp;(k=1,\dots, q) \\
0&nbsp;&nbsp;&nbsp;&nbsp;(k=q+1, q+2, \dots)
\end{cases}\end{displaymath}">
</DIV><P>
<!-- MATHEND
 
 -->
</P>
である。

<P>

<H5><A NAME="SECTION00053133000000000000">
混合自己相関-移動平均モデル（ARMAモデル）</A>
</H5>

<P>
<P><!-- MATH
 \begin{displaymath}
\epsilon_t = \sum_{i=1}^p \phi_i \epsilon_{t-i} + \sum_{j=1}^q \theta_j a_{t-j} + a_t
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="227" HEIGHT="62" ALIGN="MIDDLE" BORDER="0"
 SRC="img63.png"
 ALT="$\displaystyle \epsilon_t = \sum_{i=1}^p \phi_i \epsilon_{t-i} + \sum_{j=1}^q \theta_j a_{t-j} + a_t$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>

<P>

<H3><A NAME="SECTION00053200000000000000">
<TT>nlme</TT>における相関構造：<TT>corStruct</TT>クラス</A>
</H3>

<P>
主な引数：

<UL>
<LI><TT>value</TT>：相関パラメータ <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img42.png"
 ALT="$ \bm{\rho}$"></SPAN>
<!-- MATHEND
 
 -->
 に相当
</LI>
<LI><TT>form</TT>：位置ベクトル <!-- MATH
 $\bm{p}_{ij}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="25" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img41.png"
 ALT="$ \bm{p}_{ij}$"></SPAN>
<!-- MATHEND
 
 -->
 に相当
</LI>
</UL>

<P>
以下の4段階で用いる：

<OL>
<LI>相関関数の定義 （<TT>cs1 &lt;- corStruct()</TT>）
</LI>
<LI>初期化 （<TT>cs1 &lt;- Initialize(cs1, data = data01)</TT>）
</LI>
<LI>グループ内相関行列の抽出 （<TT>corMatrix(cs1)</TT>）
</LI>
<LI>モデルへの投入（<TT>lme(…, correlation = cs1, …)</TT>）
</LI>
</OL>

<P>

<H4><A NAME="SECTION00053210000000000000">
corCompSymm</A>
</H4> 複合対称相関構造

<P>
<PRE>
&gt; cs1 &lt;- corCompSymm(value = 0, form = ~ 1 | Subject)
</PRE>

<P>

<H4><A NAME="SECTION00053220000000000000">
corSymm</A>
</H4> 一般化相関構造

<P>
<PRE>
&gt; cs1 &lt;- corSymm(value = c(0.2, 0.1, -0.1, 0, 0.2, 0), form = ~ 1 | Subject) # 相関行列の上三角成分を左上から
</PRE>

<P>

<H4><A NAME="SECTION00053230000000000000">
corAR1</A>
</H4> 次数1の自己相関構造

<P>
<PRE>
&gt; cs1 &lt;- corAR1(value = 0.8, form = ~ 1 | Subject) # 初期値 0.8，Subject がグループ化変数
</PRE>

<P>

<H4><A NAME="SECTION00053240000000000000">
corARMA</A>
</H4> 自己相関-移動平均モデル

<P>
<PRE>
&gt; cs1 &lt;- corARMA(value = 0.4, form = ~ 1 | Subject, q=1) # \theta=0.4, 次数=1のMA(1)
&gt; cs1 &lt;- corARMA(value = c(0.8, 0.4), form = ~ 1 | Subject, p=1, q=1) # \phi=0.8, \theta=0.4, ARMA(1,1)
</PRE>

<P>

<H3><A NAME="SECTION00053300000000000000">
<TT>lme</TT>による相関構造の使用</A>
</H3>

<P>

<H4><A NAME="SECTION00053310000000000000">
相関モデルの妥当性評価</A>
</H4>

<P>
正規化した残差
<P><!-- MATH
 \begin{displaymath}
\bm{r}_i = \widehat{\sigma}^{-1} (\widehat{\bm{\Lambda}}_i^{-1/2})^T (\bm{y}-\widehat{\bm{y}}_i)
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER" CLASS="mathdisplay">
<IMG
 WIDTH="188" HEIGHT="41" ALIGN="MIDDLE" BORDER="0"
 SRC="img64.png"
 ALT="$\displaystyle \bm{r}_i = \widehat{\sigma}^{-1} (\widehat{\bm{\Lambda}}_i^{-1/2})^T (\bm{y}-\widehat{\bm{y}}_i)$">
</DIV><P>
<!-- MATHEND
 
 -->
</P>
の診断プロットを利用すると有用。

<P>
あてはめた結果から，経験的自己相関係数を
<PRE>
&gt; ACF(fm1)
</PRE>
で得る。
また，有意水準 <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img65.png"
 ALT="$ \alpha$"></SPAN>
<!-- MATHEND
 
 -->
 とした信頼区間を含め，経験的自己相関係数のラグ変化を
<PRE>
&gt; plot(ACF(fm1, maxlag = 10), alpha = 0.05)
</PRE>
でプロットできる。

<P>
<DIV STYLE="border: inset blue; background-color: white">
<PRE>
&gt; acf(residuals(fm1), lag.max=200, col="blue")
&gt; pacf(residuals(fm1), lag.max=10)
&gt; Box.test(residuals(fm1), type="Ljung")
</PRE>
で自己相関係数のプロットと独立性の検定を行える。
</DIV>

<P>

<DIV CLASS="navigation"><HR>
<IMG WIDTH="81" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next_inactive" SRC="nx_grp_g.png"> 
<A NAME="tex2html205"
  HREF="node14.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html203"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   <BR>
<B>Up:</B> <A NAME="tex2html206"
  HREF="node14.html">基本的な線形混合効果モデルの拡張</A>
<B> Previous:</B> <A NAME="tex2html204"
  HREF="node16.html">不等分散性をモデル化するための分散関数</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Okumura <BR>
2017-10-27</I>
</ADDRESS>
</BODY>
</HTML>
