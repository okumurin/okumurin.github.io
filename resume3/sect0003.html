<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta name="generator" content="plasTeX" />
<meta content="text/html; charset=utf-8" http-equiv="content-type" />
<title>階層的線形モデルによるデータ分析の実際1 — HLM6，SAS，Rを利用して —: HLM6による分析の手順</title>

<link href="sect0004.html" title="SAS PROC MIXEDによる分析" rel="next" />
<link href="sect0002.html" title="HLM6について" rel="prev" />
<link href="index.html" title="階層的線形モデルによるデータ分析の実際これは，2006年にグループ・ダイナミクス学会で行われたワークショップの配布資料をもとに作成したものである。 — HLM6，SAS，Rを利用して —" rel="up" />
<link rel="stylesheet" href="styles/styles.css" />
</head>
<body>

<div class="navigation">
<table cellspacing="2" cellpadding="0" width="100%">
<tr>
<td><a href="sect0002.html" title="HLM6について"><img alt="Previous: HLM6について" border="0" src="icons/previous.gif" width="32" height="32" /></a></td>

<td><a href="index.html" title="階層的線形モデルによるデータ分析の実際1 — HLM6，SAS，Rを利用して —"><img alt="Up: 階層的線形モデルによるデータ分析の実際1 — HLM6，SAS，Rを利用して —" border="0" src="icons/up.gif" width="32" height="32" /></a></td>

<td><a href="sect0004.html" title="SAS PROC MIXEDによる分析"><img alt="Next: SAS PROC MIXEDによる分析" border="0" src="icons/next.gif" width="32" height="32" /></a></td>

<td class="navtitle" align="center">階層的線形モデルによるデータ分析の実際<a href="#a0000000008" class="footnote"><sup class="footnotemark">1</sup></a> <br />— HLM6，SAS，Rを利用して —</td>
<td><a href="index.html" title="Table of Contents"><img border="0" alt="" src="icons/contents.gif" width="32" height="32" /></a></td>


<td><img border="0" alt="" src="icons/blank.gif" width="32" height="32" /></td>
<td><img border="0" alt="" src="icons/blank.gif" width="32" height="32" /></td>
</tr>
</table>
</div>

<div class="breadcrumbs">
<span>
<span>
<a href="index.html">階層的線形モデルによるデータ分析の実際<a href="#a0000000008" class="footnote"><sup class="footnotemark">1</sup></a> <br />— HLM6，SAS，Rを利用して —</a> <b>:</b>
</span>

</span><span>

<span>
<b class="current">HLM6による分析の手順</b>
</span>
</span>
<hr />
</div>

<div><h1 id="a0000000004">3 HLM6による分析の手順</h1>
<h2 id="a0000000012">3.1 今回の分析例</h2>
<p>今回は，最も単純な2水準（2レベル）のモデルの分析例を示すために，High School and Beyond調査からのデータを利用する。このデータはHLM6をダウンロードすれば，サンプルデータとして提供されるものである <a href="#a0000000013" class="footnote"><sup class="footnotemark">1</sup></a>。 このデータは，学校 <img src="images/img-0001.png" alt="$\rightarrow $" style="vertical-align:0px; 
                                     width:15px; 
                                     height:9px" class="math gen" /> 生徒という2段階のサンプリングを経て得られたものであり，生徒個人の情報として数学の成績（MATHACH），また学校に関する情報として学校の区分（school SECTOR：カトリックか公立か）といった変数が含まれている。 また，各生徒について家庭の社会経済的地位を表す尺度の得点（Socio-Economic Status: SES）が測定されている他，それを各学校ごとに平均した値がその学校に通う生徒の平均的な社会経済的地位を表す変数（MEANSES）として計算されている。 </p><p>今回は，生徒の数学の成績（MATHACH）が個々の生徒の家庭の社会経済的地位（SES），および生徒が属する学校の区分（SECTOR），そして学校に通う生徒の平均的社会経済的地位（MEANSES）からどのように説明されるかを2レベルの階層的線形モデルによってモデル化し，実際に分析を行う。 <a href="#a0000000014" class="footnote"><sup class="footnotemark">2</sup></a> </p><div id="table.hensu" class="table"><div class="caption"><b>Table 1</b>: <span>今回の分析で使用する変数</span></div><center> <table cellspacing="0" class="tabular">
<tr>

    
    <td style="border-top-style:solid; border-left:1px solid black; border-right:1px solid black; border-top-color:black; border-top-width:1px; text-align:center"><p> レベル１（生徒） </p></td>

    
    <td style="border-top-style:solid; text-align:center; border-top-color:black; border-top-width:1px; border-right:1px solid black"><p> レベル２（学校） </p></td>

</tr><tr>

    
    <td style="border-top-style:solid; border-left:1px solid black; border-right:1px solid black; border-top-color:black; border-top-width:1px; text-align:center"><p>MATHACH（数学の成績） </p></td>

    
    <td style="border-top-style:solid; text-align:center; border-top-color:black; border-top-width:1px; border-right:1px solid black"><p> SECTOR（学校の区分） </p></td>

</tr><tr>

    
    <td style="border-bottom-style:solid; border-bottom-width:1px; border-left:1px solid black; border-right:1px solid black; text-align:center; border-bottom-color:black"><p>SES（家庭の社会経済的地位） </p></td>

    
    <td style="border-bottom-color:black; border-bottom-width:1px; text-align:center; border-bottom-style:solid; border-right:1px solid black"><p> MEANSES（SESの学校平均） </p></td>

</tr>
</table> </center></div><h3 id="a0000000015">モデルについて</h3>
<dl class="description">

    <dt>  レベル1:</dt>
    <dd><p>ユニットは生徒（7185名）である。 <a href="#a0000000016" class="footnote"><sup class="footnotemark">3</sup></a> このレベルでは，生徒の社会経済的地位（SES）を用いて数学の成績（MATHACH）を予測する回帰式を立てる。 </p><table id="eq.level1" cellpadding="7" width="100%" cellspacing="0" class="eqnarray">
<tr id="a0000000017">
    
    <td style="width:40%">&nbsp;</td>
    
    
        <td style="vertical-align:middle;                                    text-align:right"><img src="images/img-0002.png" alt="$\displaystyle  MATHACH_{ij} = \beta _{0j} + \beta _{1j} (SES_{ij} - \bar{SES_{.j}}) + r_{ij} \label{eq.level1}  $" style="vertical-align:-4px; width:359px;                     height:20px" class="math gen" /></td>
    
    
    
    <td style="width:40%">&nbsp;</td>
    <td style="width:20%" class="eqnnum"><span>(<span>1</span>)</span></td>
</tr>
</table></dd>

    <dt>  レベル2:</dt>
    <dd><p>ユニットは学校（160校）である。 <a href="#a0000000018" class="footnote"><sup class="footnotemark">4</sup></a> このレベルでは，レベル1の回帰式における学校ごとの切片と傾きを学校の区分（SECTOR）および学校の平均的な社会経済的地位（MEANSES）によって予測する回帰式を立てる。 </p><p><a href="#a0000000019" class="footnote"><sup class="footnotemark">5</sup></a> </p><table id="eq.level2-1" cellpadding="7" width="100%" cellspacing="0" class="eqnarray">
<tr id="a0000000020">
    
    <td style="width:40%">&nbsp;</td>
    
    
        <td style="vertical-align:middle;                                    text-align:right"><img src="images/img-0003.png" alt="$\displaystyle  \beta _{0j} = \gamma _{00} + \gamma _{01} (SECTOR_ j) + \gamma _{02} (MEANSES_ j) + u_{0j} \label{eq.level2-1}  $" style="vertical-align:-4px; width:404px;                     height:18px" class="math gen" /></td>
    
    
    
    <td style="width:40%">&nbsp;</td>
    <td style="width:20%" class="eqnnum"><span>(<span>5</span>)</span></td>
</tr><tr id="eq.level2-2">
    
    <td style="width:40%">&nbsp;</td>
    
    
        <td style="vertical-align:middle;                                    text-align:right"><img src="images/img-0004.png" alt="$\displaystyle \beta _{1j} = \gamma _{10} + \gamma _{11} (SECTOR_ j) + \gamma _{12} (MEANSES_ j) + u_{1j} \label{eq.level2-2}  $" style="vertical-align:-4px; width:404px;                     height:18px" class="math gen" /></td>
    
    
    
    <td style="width:40%">&nbsp;</td>
    <td style="width:20%" class="eqnnum"><span>(<span>6</span>)</span></td>
</tr>
</table></dd>

</dl><h2 id="a0000000021">3.2 分析の手順</h2>
<p>HLM6では，以下のような手順で分析を行う。 また，分析を行う過程で様々なファイルが作成される。 </p><ol class="enumerate">
<li><p>データファイルの作成 </p></li><li><p>データファイルを読み込み，十分統計量を計算する </p><ul class="itemize">
<li><p>分析に用いるモデルの選択（レベルの数など） </p></li><li><p>データファイルの読み込み，変数の指定など </p></li><li><p>MDMTファイル（.mdmt）を作成（MDMファイルで指定した内容を格納） </p></li><li><p>十分統計量を計算し，MDMファイル（.mdm）として保存 </p></li><li><p>STSファイル（.sts）を確認（基本統計量を格納） </p></li>
</ul></li><li><p>モデル式を指定し，出力や推定に関するオプションを指定 </p><ul class="itemize">
<li><p>指定した内容を，HLMファイル（.hlm）もしくはMLMファイル（.mlm）で保存 </p></li>
</ul></li><li><p>分析の実行 </p></li><li><p>結果の確認 </p></li>
</ol><h2 id="a0000000022">3.3 データファイルの作成</h2>
<p>HLM6においては，データファイルはそれぞれのレベルごとに1つずつ作成する必要がある。 <a href="#a0000000023" class="footnote"><sup class="footnotemark">6</sup></a> すなわち2レベルのモデルであれば2種類の，3レベルのモデルであれば3種類のデータファイルを作成することになる。 </p><p>HLM6においてデータファイルを作成するには，以下の2つの方法がある。 </p><ol class="enumerate">
<li><p>ASCII形式（通常のテキストファイル）を用いる方法 </p></li><li><p>他の統計パッケージのファイルを入力として用いる方法<a href="#a0000000024" class="footnote"><sup class="footnotemark">7</sup></a> </p></li>
</ol><p>以下，各々について説明する。 </p><h3 id="a0000000025">ASCII形式によるデータファイルの作成</h3>
<h3 id="a0000000026">データのフォーマット</h3>
<p>HLM6では，データ入力のフォーマットが厳格に定められている。 以下にその規則のうち重要と思われるものを挙げる。 </p><ul class="itemize">
<li><p>データの読み込みはカラム指定で行われるので，スペースを調整するなどして各変数ごとに縦の列をそろえておく。 </p></li><li><p>データファイルにはIDを表す変数を入れる必要がある。 <a href="#a0000000027" class="footnote"><sup class="footnotemark">8</sup></a> ID変数は，自身よりも一段上のレベルのケースとの対応を示すものであり，そのレベルのケースのIDではない。 </p></li><li><p>すべてのデータはID変数の値ごとにまとめられていなければいけない。 <a href="#a0000000028" class="footnote"><sup class="footnotemark">9</sup></a> </p></li><li><p>同じファイル内のID変数の桁はそろえておかなくてはならない。 </p></li><li><p>欠測値は，レベル1のデータファイルでのみ許される。 <a href="#a0000000029" class="footnote"><sup class="footnotemark">10</sup></a> </p></li>
</ul><h3 id="a0000000030">レベル1のデータファイル (HSB1.DAT)</h3>
<div class="figure"><center> 
<img src="images/img-0005.png" alt="\includegraphics[width=15cm]{hsb1.png}" style="width:15cm" /> </center></div><h3 id="a0000000031">レベル2のデータファイル (HSB2.DAT)</h3>
<div class="figure"><center> 
<img src="images/img-0006.png" alt="\includegraphics[width=15cm]{hsb2.ps}" style="width:15cm" /> </center></div><h3 id="a0000000032">SPSSファイルによるデータセットの作成</h3>
<p>SPSSのデータファイル形式（.sav）によってデータセットを作成することもできる。 この方法では各セルに1つずつデータを入れることから，ASCIIのようにカラムをそろえるなどの配慮を行わなくてよく，後で説明するMDMファイルの作成もASCII形式のデータファイルを用いた場合よりも簡単にできるなど，何かと便利である。 </p><p>その他の規則はASCIIによる方法のところで述べたのと同様である。 </p><h3 id="a0000000033">レベル1のデータファイル (HSB1.SAV)</h3>
<div class="figure"><center> 
<img src="images/img-0007.png" alt="\includegraphics[width=10cm]{hsb1-sav.ps}" style="width:10cm" /> </center></div><h3 id="a0000000034">レベル2のデータファイル (HSB2.SAV)</h3>
<p> <a href="#a0000000035" class="footnote"><sup class="footnotemark">11</sup></a> </p><div class="figure"><center> 
<img src="images/img-0008.png" alt="\includegraphics[width=12cm]{hsb2-sav.ps}" style="width:12cm" /> </center></div><h2 id="a0000000036">3.4 MDMファイルの作成</h2>
<p>HLM6では，実際の分析は生データを直接用いるのではなく，それをいったん処理したMDM（Multivariate Data Matrix）ファイル（.mdm）の情報を用いて行われる。 <a href="#a0000000037" class="footnote"><sup class="footnotemark">12</sup></a> 従って，分析を行う前にまず生データを入力したファイルからMDMファイルを作成する必要がある。 また，いったんMDMファイルを作っておけば，その後の分析には生データファイルを直接用いることなく，すでに作ったMDMファイルを繰り返して使うことができる。 </p><p>ここでは，前項で取り上げたASCII形式で作成されたデータファイル（.datファイル）およびSPSSによって作成されたデータファイル（.savファイル）からMDMファイルを作成する方法について解説する。 </p><h3 id="a0000000038">HLM6の起動</h3>
<p>まず，HLM6のショートカットをダブルクリックしてHLM6を起動する。 <a href="#a0000000039" class="footnote"><sup class="footnotemark">13</sup></a> </p><div class="figure"><center> 
<img src="images/img-0009.png" alt="\includegraphics[width=2cm]{kidou.ps}" style="width:2cm" /> </center></div><p>すると，以下のようなウィンドウが立ち上がるはずである。 HLM6の操作は基本的にこのウィンドウから行うことになる。 </p><div class="figure"><center> 
<img src="images/img-0010.png" alt="\includegraphics[width=15cm]{kidougamen.ps}" style="width:15cm" /> </center></div><h3 id="a0000000040">ASCII形式によるデータファイルを用いたMDMファイルの作成</h3>
<p>ここでは，ASCII形式で作成したデータファイルを用いてMDMファイルを作成する方法について説明する。 </p><p>前項で，データファイルはモデルの水準の数だけ必要であると説明したが，MDMファイルは1つのモデルに1つ作ればよい。 </p><p>まず，[File]-[Make new MDM file]-[ASCII input]とメニューを選択する。 </p><div class="figure"><center> 
<img src="images/img-0011.png" alt="\includegraphics[width=12cm]{makemdm-ascii1.ps}" style="width:12cm" /> </center></div><p>次に，分析するモデルのタイプを選択し，[OK]をクリックする。 </p><p><a href="#a0000000041" class="footnote"><sup class="footnotemark">14</sup></a> </p><div class="figure"><center> 
<img src="images/img-0012.png" alt="\includegraphics[width=6cm]{makemdm-ascii2.ps}" style="width:6cm" /> </center></div><p>"Make MDM - HLM2"が開く。 ここで，データファイルからMDMファイルを作成するためのデータに関する情報を指定することになる。 </p><p>以下に，各項目について入力・指定の方法について述べる。 </p><div class="figure"><center> 
<img src="images/img-0013.png" alt="\includegraphics[width=16cm]{makemdm-ascii3.ps}" style="width:16cm" /> </center></div><h3 id="a0000000042">MDM File Name</h3>
<p>作成するMDMファイルの名前を拡張子つきで入力する。 <a href="#a0000000043" class="footnote"><sup class="footnotemark">15</sup></a> </p><h3 id="a0000000044">Nesting of input data</h3>
<p>データの種類が，「集団−個人」であるか「個人−測定」であるかを指定する。 <a href="#a0000000045" class="footnote"><sup class="footnotemark">16</sup></a> 分析の内容には直接関係ないが，後にモデル式の指定をする際にどちらを選択したかで記号の区別がなされることになる。 </p><h3 id="a0000000046">Level-1 Specification</h3>
<p>ここでは，レベル1のデータセットについての情報を指定することになる。 </p><dl class="description">

    <dt>    Level-1 File Name:</dt>
    <dd><p>レベル1のデータファイルをフルパスで入力する。 <a href="#a0000000047" class="footnote"><sup class="footnotemark">17</sup></a> あるいは，右にある"Browse"ボタンをクリックしてファイルを選択すれば，自動的にそのファイルのフルパスが入力される。 </p></dd>

    <dt>    Number of Variables:</dt>
    <dd><p><a href="#a0000000048" class="footnote"><sup class="footnotemark">18</sup></a>ID変数を除いた変数の数を半角で入力する。 </p></dd>

    <dt>    Missing Data:</dt>
    <dd><p>データに欠側がある場合はここで宣言しておく。 <a href="#a0000000049" class="footnote"><sup class="footnotemark">19</sup></a>欠測値があれば，欠側のあるケースをどの段階で削除するか（MDMファイルを作る段階/分析を行う段階）を選択することになる。 </p></dd>

    <dt>    Data Format:</dt>
    <dd><p>データのフォーマット（変数のカラム）の指定を行う。 <a href="#a0000000050" class="footnote"><sup class="footnotemark">20</sup></a> その際の規則は以下のとおりである。 </p><ul class="itemize">
<li><p>"A"はID変数を読み込むための記述子である。"A"の後に，ID変数が何桁あるかを数字で入力する。 </p></li><li><p>"F"は実際のデータを読むための記述子である。<a href="#a0000000051" class="footnote"><sup class="footnotemark">21</sup></a>"F"の前にある数字は繰り返し数（ID変数を除く変数の数）である。"F"の後には，"[カラム数].[小数点以下の桁数]"を入力する。</p></li><li><p>"X"は，カラムを飛ばすための記述子である。<a href="#a0000000052" class="footnote"><sup class="footnotemark">22</sup></a> </p></li><li><p>"/"は，データの読み込みが2行以上にわたる際に改行を指定する記述子である。</p></li><li><p>以上の各記述子は，カンマ（","）で区切る。 </p></li>
</ul></dd>

    <dt>    Labels:</dt>
    <dd><p>クリックしてウィンドウを開き，変数のラベル（変数名）を半角英数字で入力する。日本語で入力すると文字化けしてしまうので注意。<a href="#a0000000053" class="footnote"><sup class="footnotemark">23</sup></a> </p><div class="figure"><center> 
<img src="images/img-0014.png" alt="\includegraphics[width=8cm]{makemdm-ascii4.ps}" style="width:8cm" /> </center></div></dd>

</dl><h3 id="a0000000054">Level-2 Specification</h3>
<p> レベル2のデータファイルに関する情報を入力する。 <a href="#a0000000055" class="footnote"><sup class="footnotemark">24</sup></a> 基本的にレベル1の場合と同様に行えばよいが，欠測はレベル2以上では許容されないためこれに関しては指定を行わない。 </p><h3 id="a0000000056">Save mdmt file</h3>
<p>[Save mdmt file]をクリックして，MDMT（MDM Template）ファイル（.mdmt）を作る。 MDMTファイルには，MDMファイルを作るために指定した情報<a href="#a0000000057" class="footnote"><sup class="footnotemark">25</sup></a>が格納される <a href="#a0000000058" class="footnote"><sup class="footnotemark">26</sup></a>。 </p><h3 id="a0000000059">Make MDM</h3>
<p>[Make MDM]ボタンをクリックして，MDMファイルをつくる。 次のような画面が現れて，MDMファイルが作られたことがわかる。 <a href="#a0000000060" class="footnote"><sup class="footnotemark">27</sup></a> </p><div class="figure"><center> 
<img src="images/img-0015.png" alt="\includegraphics[width=10cm]{prompt1.ps}" style="width:10cm" /> </center></div><h3 id="a0000000061">Check Stats</h3>
<p>[Check Stats]ボタンをクリックすると，各変数の基本統計量を格納したSTSファイル（hlm2mdm.sts）を確認することができる。<a href="#a0000000062" class="footnote"><sup class="footnotemark">28</sup></a> </p><div class="figure"><center> 
<img src="images/img-0016.png" alt="\includegraphics[width=15cm]{makemdm-ascii5.ps}" style="width:15cm" /> </center></div><h3 id="a0000000063">Done</h3>
<p>[Done]ボタンをクリックすることでMDMファイルの作成段階は終了し，モデルの指定を行う画面が現れる。 <a href="#a0000000064" class="footnote"><sup class="footnotemark">29</sup></a> </p><h3 id="a0000000065">SPSSによるデータファイルを用いたMDMファイルの作成</h3>
<p>ここでは，SPSSによって作成した.sav形式によるデータファイルを用いてMDMファイルを作成する方法を解説する。 </p><p>まず，[File]-[Make new MDM file]-[Stat package input]とメニューを選択する。 </p><div class="figure"><center> 
<img src="images/img-0017.png" alt="\includegraphics[width=12cm]{makemdm-spss1.ps}" style="width:12cm" /> </center></div><p>次に，分析するモデルのタイプを選択し，[OK]をクリックする。 </p><p><a href="#a0000000066" class="footnote"><sup class="footnotemark">30</sup></a> </p><div class="figure"><center> 
<img src="images/img-0012.png" alt="\includegraphics[width=6cm]{makemdm-ascii2.ps}" style="width:6cm" /> </center></div><p>"Make MDM - HLM2"が開く。 </p><div class="figure"><center> 
<img src="images/img-0018.png" alt="\includegraphics[width=15cm]{makemdm-spss5.ps}" style="width:15cm" /> </center></div><p>ここで，データファイルからMDMファイルを作成するためのデータに関する情報を指定することになる。 </p><p>以下に，各項目について入力・指定の方法について述べる。 </p><h3 id="a0000000067">MDM File Name</h3>
<p>作成するMDMファイルの名前を拡張子（.mdm）つきで入力する。 <a href="#a0000000068" class="footnote"><sup class="footnotemark">31</sup></a> </p><h3 id="a0000000069">Input File Type</h3>
<p>ここで，データファイルの形式をプルダウンメニューから選択する。 <a href="#a0000000070" class="footnote"><sup class="footnotemark">32</sup></a> </p><h3 id="a0000000071">Nesting of input data</h3>
<p>データの種類が，「集団−個人」であるか「個人−測定」であるかを指定する。 <a href="#a0000000072" class="footnote"><sup class="footnotemark">33</sup></a> </p><h3 id="a0000000073">Level-1 Specification</h3>
<p>ここでは，レベル1のデータファイルに関する指定を行う。 </p><dl class="description">

    <dt>    Browse:</dt>
    <dd><p>[Browse]ボタンをクリックしてファイルを選択し，<a href="#a0000000074" class="footnote"><sup class="footnotemark">34</sup></a>"Level-1 File Name: "の右側に，データファイルのフルパスが表示されるのを確認。 </p></dd>

    <dt>    Choose Variabes: </dt>
    <dd><p>[Choose Variables]をクリックして，レベル1のデータファイルから読み込む変数の指定（四角をクリックしてチェックをつける）を行う。SPSSファイルではすでに変数名がつけられているので，ここではID変数およびMDMファイルに読み込む変数（分析の対象としたい変数）を指定するだけでよい。 </p><div class="figure"><center> 
<img src="images/img-0019.png" alt="\includegraphics[width=8cm]{makemdm-spss3.ps}" style="width:8cm" /> </center></div></dd>

    <dt>    欠測値に関する指定:</dt>
    <dd><p>もし欠測値があれば "Missing Data?" で "Yes" を，なければ "No" を選択する。 <a href="#a0000000075" class="footnote"><sup class="footnotemark">35</sup></a> "Yes"を選択した場合は，欠測値を含むケースをいずれの段階で除去するか（MDMファイルを作る段階 / 分析を行う段階），選択する。 </p></dd>

</dl><h3 id="a0000000076">Level-2 Specification</h3>
<p>次に，レベル2のデータファイルに関する指定を行う。 </p><dl class="description">

    <dt>    Browse:</dt>
    <dd><p>[Browse]ボタンをクリックして，<a href="#a0000000077" class="footnote"><sup class="footnotemark">36</sup></a>レベル2のデータファイルを指定する。 </p></dd>

    <dt>    Choose Variables:</dt>
    <dd><p>[Choose Variables]ボタンをクリックして，レベル2で読み込む変数の指定を行う。 </p></dd>

</dl><div class="figure"><center> 
<img src="images/img-0020.png" alt="\includegraphics[width=8cm]{makemdm-spss4.ps}" style="width:8cm" /> </center></div><h3 id="a0000000078">Save mdmt file</h3>
<p> [Save mdmt file]をクリックして，MDMテンプレートファイルを保存する。 <a href="#a0000000079" class="footnote"><sup class="footnotemark">37</sup></a> </p><h3 id="a0000000080">Make MDM</h3>
<p> [Make MDM]をクリックして，MDMファイルを作成する。 次のような画面が現れて，MDMファイルが作られたことがわかる。 <a href="#a0000000081" class="footnote"><sup class="footnotemark">38</sup></a> </p><div class="figure"><center> 
<img src="images/img-0015.png" alt="\includegraphics[width=8cm]{prompt1.ps}" style="width:8cm" /> </center></div><h3 id="a0000000082">Check Stats</h3>
<p>[Check Stats]ボタンをクリックすると，各変数の基本統計量を格納したSTSファイル（hlm2mdm.sts）を確認することができる。<a href="#a0000000083" class="footnote"><sup class="footnotemark">39</sup></a> </p><div class="figure"><center> 
<img src="images/img-0016.png" alt="\includegraphics[width=12cm]{makemdm-ascii5.ps}" style="width:12cm" /> </center></div><h3 id="a0000000084">Done</h3>
<p>[Done]ボタンをクリックすることでMDMファイルの作成段階は終了し，モデルの指定を行う画面が現れる。 </p><div class="figure"><center> 
<img src="images/img-0021.png" alt="\includegraphics[width=10cm]{makehlm1.ps}" style="width:10cm" /> </center></div><h2 id="a0000000085">3.5 モデルの指定</h2>
<p>MDMファイルを作成したあとは，それを元に実際に分析したい統計モデルを指定することになる。<a href="#a0000000086" class="footnote"><sup class="footnotemark">40</sup></a> </p><p>HLM6では，式(<a href="sect0003.html#eq.level1">1</a>)から式(<a href="sect0003.html#eq.level2-2">6</a>)に従って変数を指定していけばモデルの指定ができる。 こうした直感的な操作を可能にする優れたGUI機能を持つことがHLM6の大きな特徴となっている。 </p><h3 id="a0000000087">レベル1のモデル式</h3>
<p>式(<a href="sect0003.html#eq.level1">1</a>)のとおり，ここでは，生徒の数学の成績（MATHACH）をその生徒の家庭の社会経済的地位（SES）で説明するモデル式を立てる。 </p><p>まず，[Level-1]ボタンをクリックして，レベル1の入力モードにする（通常はすでになっている）。 下にレベル1のモデル式に投入するための変数の一覧が表示されているので，そこから"MATHACH"をクリックし，"Outcome variable"を選択する。 </p><div class="figure"><center> 
<img src="images/img-0022.png" alt="\includegraphics[width=10cm]{makehlm2.ps}" style="width:10cm" /> </center></div><p>これで，"MATHACH"が従属変数に入ったモデル式が表示される。 </p><div class="figure"><center> 
<img src="images/img-0023.png" alt="\includegraphics[width=10cm]{makehlm3.ps}" style="width:10cm" /> </center></div><p>次に，"SES"をクリックして，"add variable group centered"を選択する。 これを選択した場合，説明変数の部分が太字（ボールド体）で表示される。 <a href="#a0000000088" class="footnote"><sup class="footnotemark">41</sup></a> </p><div class="figure"><center> 
<img src="images/img-0024.png" alt="\includegraphics[width=10cm]{makehlm4.ps}" style="width:10cm" /> </center></div><p>レベル1のモデル式に説明変数として"SES"が投入されたのが確認できる。 もし間違った変数を投入してしまった際は，その変数をもう一度選択し，"Delete variable from model"を選択すればよい。 </p><div class="figure"><center> 
<img src="images/img-0025.png" alt="\includegraphics[width=15cm]{makehlm5.ps}" style="width:15cm" /> </center></div><h3 id="a0000000089">レベル2のモデル式</h3>
<p>[Level-2]をクリックして，レベル2のモデルの入力モードに切り替える。 切り替えた直後は，レベル1のモデル式の切片（<img src="images/img-0026.png" alt="$\beta _0$" style="vertical-align:-3px; 
                                     width:15px; 
                                     height:14px" class="math gen" />）を説明するモデル式の部分が黄色くなっており，まずこの部分の入力を行う。 式(<a href="sect0003.html#eq.level2-1">5</a>)を参照し，先ほどと同じように"SECTOR"および"MEANSES"を説明変数として投入する（ここではともに"uncenterd"を選択。この場合説明変数は細字で表示される。）。 </p><p>次に，<img src="images/img-0027.png" alt="$\beta _1$" style="vertical-align:-3px; 
                                     width:15px; 
                                     height:14px" class="math gen" />を説明するモデル式のエリアをクリックして，ここを黄色くさせる。 式(<a href="sect0003.html#eq.level2-2">6</a>)を参照し，先ほどと同じように"SECTOR"および"MEANSES"を説明変数として投入する（ここではともに"uncenterd"を選択。）。 </p><div class="figure"><center> 
<img src="images/img-0028.png" alt="\includegraphics[width=15cm]{makehlm6.ps}" style="width:15cm" /> </center></div><p>ここで，よく見るとレベル2の残差（<img src="images/img-0029.png" alt="$u_1$" style="vertical-align:-2px; 
                                     width:16px; 
                                     height:9px" class="math gen" />）が灰色になっているのに気づく。 これは残差成分がモデル式に投入されていないことを示しているので，この部分をクリックして黒くする。これで<img src="images/img-0029.png" alt="$u_1$" style="vertical-align:-2px; 
                                     width:16px; 
                                     height:9px" class="math gen" />がモデルに投入された。 <a href="#a0000000090" class="footnote"><sup class="footnotemark">42</sup></a> </p><div class="figure"><center> 
<img src="images/img-0030.png" alt="\includegraphics[width=15cm]{makehlm7.ps}" style="width:15cm" /> </center></div><h2 id="a0000000091">3.6 オプションの指定</h2>
<p>次に，さまざまなオプションの設定を行う。 <a href="#a0000000092" class="footnote"><sup class="footnotemark">43</sup></a> </p><h3 id="a0000000093">Basic Settings</h3>
<p>[Basic Settings]メニューでは，従属変数の分布に関する指定，結果のファイルの名前，分析のタイトル，残差ファイル指定などを行うことができる。 </p><p>まず，[Basic Setting]をクリックする。 <a href="#a0000000094" class="footnote"><sup class="footnotemark">44</sup></a> </p><div class="figure"><center> 
<img src="images/img-0031.png" alt="\includegraphics[width=12cm]{basic1.ps}" style="width:12cm" /> </center></div><h3 id="a0000000095">残差ファイルの指定</h3>
<p>ここでは，残差を出力するファイルの指定について説明する。 残差ファイルには，各レベルの残差だけでなくレベル１の切片や傾きの推定値など重要な情報がたくさん含まれている。 残差ファイルの設定は，各レベルごとに行う。 </p><p>まず，レベル１の残差ファイルの設定を行うために，[Level-1 Residual File]をクリックする。 </p><div class="figure"><center> 
<img src="images/img-0032.png" alt="\includegraphics[width=12cm]{basic2.ps}" style="width:12cm" /> </center></div><p>レベル１，レベル２それぞれの"Variables in residual file"に，モデルの設定のところで投入した変数がそのまま入っているはずである。 もし必要であればさらに変数をダブルクリックして投入することができる。 ただし，すでにモデルに投入ずみの変数は取り除くことができない。 </p><p>ここではデフォルトのままとし，"Residual File Type"で"SPSS"を選択した。 <a href="#a0000000096" class="footnote"><sup class="footnotemark">45</sup></a> ファイル名もデフォルトのまま，"resfil1.sav"とした。 </p><p>[OK]をクリックしてこのウィンドウを閉じる。 </p><p>次に，レベル2モデルの残差ファイルを指定する。 [Level-2 Residual File]をクリックする。 </p><div class="figure"><center> 
<img src="images/img-0033.png" alt="\includegraphics[width=8cm]{basic3.ps}" style="width:8cm" /> </center></div><p>ここでも，"Variables in residual file"に，モデルの設定のところで投入したレベル２の変数がそのまま入っているはずである。 レベル1のときと同様，変数に関してはデフォルトのままとし，"Residual File Type"で"SPSS"を選択し，[OK]をクリックする。 </p><p>これで，分析後"resfil1.sav"および"resfil2.sav"という2つの残差ファイルができるはずである。 </p><h3 id="a0000000097">タイトルと結果の出力ファイル名の指定</h3>
<p>"Title"に，この分析のタイトルを入れる。 <a href="#a0000000098" class="footnote"><sup class="footnotemark">46</sup></a> </p><p>"Output file name"に，出力ファイルの名前をフルパスで入力する。 ここでは，デフォルトのままとした。 </p><p>"Graph file name"に，グラフを作る際のファイルの名前をフルパスで入力する。 ここでは，デフォルトのままとした。 </p><p>[OK]をクリックして，終了。 </p><h3 id="a0000000099">Other Settings</h3>
<p>ここでは，反復計算，推定法，統計的検定に関する設定などを行うことができる。 今回はデフォルトのままにしておく。 </p><h2 id="a0000000100">3.7 HLMファイルの保存</h2>
<p>ここまで設定した内容は，実際に分析を行う前にHLMファイル（.hlm）<a href="#a0000000101" class="footnote"><sup class="footnotemark">47</sup></a>として保存する必要がある。 </p><p>[File]-[Save As]で適切なファイル名を指定し，HLMファイルを保存する。 <a href="#a0000000102" class="footnote"><sup class="footnotemark">48</sup></a> </p><h2 id="a0000000103">3.8 分析の実行</h2>
<p>[Run Analysis]をクリックする。 <a href="#a0000000104" class="footnote"><sup class="footnotemark">49</sup></a> </p><p>反復計算の過程を表す画面が表示される。 計算が終わると，自動的に消える。 <a href="#a0000000105" class="footnote"><sup class="footnotemark">50</sup></a> </p><div class="figure"><center> 
<img src="images/img-0034.png" alt="\includegraphics[width=12cm]{prompt2.ps}" style="width:12cm" /> </center></div><h2 id="henkaikikeisu">3.9 結果の確認</h2>
<p>分析はここで終了したので，結果を確認する。 [File]-[View Output]とクリックすると，結果を格納したテキストファイルが自動的に立ち上がる。 <a href="#a0000000106" class="footnote"><sup class="footnotemark">51</sup></a> </p><div class="figure"><center> 
<img src="images/img-0035.png" alt="\includegraphics[width=15cm]{result1.ps}" style="width:15cm" /> </center></div><p>以下では，このファイルを見ながら結果の解釈を行うことになる。 </p><p><a href="#a0000000107" class="footnote"><sup class="footnotemark">52</sup></a> </p><h3 id="a0000000108">基本的な情報</h3>
<p><small class="footnotesize"><pre>

 SPECIFICATIONS FOR THIS HLM2 RUN

# 分析のタイトル #
  Problem Title: HSB-GD　

# 分析に使用したMDMファイル #
  The data source for this run  = hsb-gd.mdm

# モデルの指定を行った.hlmファイル #
  The command file for this run = C:\Program Files\HLM6S\Examples\AppendxA\hsb-gd.hlm 

# 出力ファイルの名前 #
  Output file name              = C:\Program Files\HLM6S\Examples\AppendxA\hlm2.txt

# サンプルサイズおよび指定した反復回数 #
  The maximum number of level-1 units = 7185
  The maximum number of level-2 units = 160
  The maximum number of iterations = 100

# 分散・共分散行列の推定の方法（デフォルトでは，制約つき最尤推定。） #
  Method of estimation: restricted maximum likelihood

# 重み付けに関する情報 #
 Weighting Specification
 -----------------------
                         Weight
                         Variable
            Weighting?   Name        Normalized?
 Level 1        no       
 Level 2        no       
 Precision      no  
</pre></small></p><h3 id="a0000000109">モデルの確認</h3>
<pre>

# 従属変数はMATHACH #
  The outcome variable is  MATHACH    

# モデルに含まれる切片および傾き（偏回帰係数）をレベルごとに表示 #
  The model specified for the fixed effects was:
 ----------------------------------------------------

   Level-1                  Level-2
   Coefficients             Predictors
 ----------------------   ---------------
         INTRCPT1, B0      INTRCPT2, G00   
                             SECTOR, G01   
                            MEANSES, G02   
 *      SES slope, B1      INTRCPT2, G10   
                             SECTOR, G11   
                            MEANSES, G12   

# SESは集団平均でセンタリングした。 #
'*' - This level-1 predictor has been centered around its group mean.

# 分散，共分散行列に関する指定 #
 The model specified for the covariance components was:
 ---------------------------------------------------------

         Sigma squared (constant across level-2 units)

         Tau dimensions
               INTRCPT1
                    SES slope

# 指定したモデル式を提示 #
 Summary of the model specified (in equation format)
 ---------------------------------------------------

Level-1 Model

	Y = B0 + B1*(SES) + R

Level-2 Model
	B0 = G00 + G01*(SECTOR) + G02*(MEANSES) + U0
	B1 = G10 + G11*(SECTOR) + G12*(MEANSES) + U1

</pre><h3 id="a0000000110">分散・共分散行列の推定結果</h3>
<pre>
# 収束するまでの反復数 #
Iterations stopped due to small change in likelihood function
******* ITERATION 61 *******

# レベル1の分散の推定値 #
 Sigma_squared =     36.70313

# レベル2の分散・共分散行列の推定値 #
 Tau
 INTRCPT1,B0      2.37996       0.19058 
      SES,B1      0.19058       0.14892 

# レベル2の分散・共分散行列を相関行列に直したもの #
Tau (as correlations)
 INTRCPT1,B0  1.000  0.320
      SES,B1  0.320  1.000

# レベル1の切片と傾きの推定値の信頼性 (Reliability) #
 ----------------------------------------------------
  Random level-1 coefficient   Reliability estimate
 ----------------------------------------------------
  INTRCPT1, B0                        0.733
       SES, B1                        0.073
 ----------------------------------------------------
# 信頼性の値が1に近いほど，レベル1の切片と傾きを推定する際にサンプル全体の情報に対して 
# 当該集団の情報を利用する割合が大きくなる。信頼性は集団ごとに算出されるものであるが， 
# ここでは全集団にわたって平均した値が報告されている。#
</pre><h3 id="a0000000111">レベル2の切片と偏回帰係数の推定値</h3>
<pre>

# 最終的な尤度関数の値 #
The value of the likelihood function at iteration 61 = -2.325094E+004

# レベル2の切片と偏回帰係数の推定値と検定統計量，有意性検定の結果 #
 The outcome variable is  MATHACH
 Final estimation of fixed effects:
 ----------------------------------------------------------------------------
                                       Standard             Approx.
    Fixed Effect         Coefficient   Error      T-ratio   d.f.     P-value
 ----------------------------------------------------------------------------
 For       INTRCPT1, B0
    INTRCPT2, G00          12.096006   0.198734    60.865       157    0.000
      SECTOR, G01           1.226384   0.306272     4.004       157    0.000
     MEANSES, G02           5.333056   0.369161    14.446       157    0.000
 For      SES slope, B1
    INTRCPT2, G10           2.937981   0.157135    18.697       157    0.000
      SECTOR, G11          -1.640954   0.242905    -6.756       157    0.000
     MEANSES, G12           1.034427   0.302566     3.419       157    0.001
 ----------------------------------------------------------------------------
 The outcome variable is  MATHACH

# 最高次のレベルのサンプルサイズが極めて大きい場合は，（特に分散共分散行列に関する設定が間違って
# いるかもしれないことを見越して）こちらの結果を採用するのが望ましいとされている。今回はこちらを
# 見ればよい。（こちらを参照する必要がない場合はそのような指示が表示される。）
 Final estimation of fixed effects
 (with robust standard errors)
 ----------------------------------------------------------------------------
                                       Standard             Approx.
    Fixed Effect         Coefficient   Error      T-ratio   d.f.     P-value
 ----------------------------------------------------------------------------
 For       INTRCPT1, B0
    INTRCPT2, G00          12.096006   0.173699    69.638       157    0.000
      SECTOR, G01           1.226384   0.308484     3.976       157    0.000
     MEANSES, G02           5.333056   0.334600    15.939       157    0.000
 For      SES slope, B1
    INTRCPT2, G10           2.937981   0.147620    19.902       157    0.000
      SECTOR, G11          -1.640954   0.237401    -6.912       157    0.000
     MEANSES, G12           1.034427   0.332785     3.108       157    0.003
 ----------------------------------------------------------------------------
</pre><h3 id="a0000000112">最終的な分散の推定値</h3>
<pre>

# 最終的な分散の推定値と検定結果 #
 Final estimation of variance components:
 -----------------------------------------------------------------------------
 Random Effect           Standard      Variance     df    Chi-square  P-value
                         Deviation     Component
 -----------------------------------------------------------------------------
 INTRCPT1,       U0        1.54271       2.37996   157     605.29503    0.000
      SES slope, U1        0.38590       0.14892   157     162.30867    0.369
  level-1,       R         6.05831      36.70313
 -----------------------------------------------------------------------------
</pre><h3 id="a0000000113">Devianceなど</h3>
<pre>

# Deviance #
 Statistics for current covariance components model
 --------------------------------------------------
 Deviance                       = 46501.875643
# 推定した分散・共分散の数 #
 Number of estimated parameters = 4
</pre><p><span class="normalsize"></span></p><h2 id="a0000000114">3.10 グラフの表示など</h2>
<p>HLM6には，さまざまなグラフを表示させる機能がついている。 ここでは，例として式(<a href="sect0003.html#eq.level1">1</a>)で示したレベル1の回帰式が，学校の属性を表すSECTORによってどのように異なるのかグラフで示してみたい。 </p><p>[File]-[Graph Equations]-[Level-1 equation graphing]を選択する。 </p><div class="figure"><center> 
<img src="images/img-0036.png" alt="\includegraphics[width=15cm]{graph1.ps}" style="width:15cm" /> </center></div><p>レベル1のモデル式をグラフ化するためのウィンドウが立ち上がる。 </p><div class="figure"><center> 
<img src="images/img-0037.png" alt="\includegraphics[width=10cm]{graph2.ps}" style="width:10cm" /> </center></div><h3 id="a0000000115">X-focus</h3>
<dl class="description">

    <dt>    Level-1:</dt>
    <dd><p>レベル1の説明変数を投入する。ここでは，"SES"を選択。 </p></dd>

    <dt>    Number of groups:</dt>
    <dd><p>表示するグループの数を選択する。ここでは，"All groups"を選択。 </p></dd>

</dl><h3 id="a0000000116">Z-focus</h3>
<p> 学校を分類する変数を選択。ここでは，"SECTOR"を選択。<br /></p><p>[OK]をクリックすると，グラフが表示される。 </p><div class="figure"><center> 
<img src="images/img-0038.png" alt="\includegraphics[width=15cm]{graph3.ps}" style="width:15cm" />  </center></div><p>このグラフを見ると，Cathoric（SECTOR=1）の学校のほうが切片の値は大きいが傾きは小さい傾向にあることがわかる。 これはSECTORにかかるレベル2の偏回帰係数の推定値の符号と一致している。 </p><p>ここで，<a href="sect0003.html#henkaikikeisu">*</a>ページに示したレベル2の偏回帰係数の推定結果の欄を次に再掲したのでグラフとの対応を確認されたい。 </p><p>変数SECTORにかかる偏回帰係数の値に関して，切片（"<tt class="ttfamily">INTRCPT1, B0</tt>"）欄では<img src="images/img-0039.png" alt="$1.226384$" style="vertical-align:0px; 
                                     width:60px; 
                                     height:12px" class="math gen" />とプラスの値であるのに対し，傾き（"<tt class="ttfamily">SES slope, B1</tt>"）欄では<img src="images/img-0040.png" alt="$-1.640954$" style="vertical-align:0px; 
                                     width:73px; 
                                     height:13px" class="math gen" />とマイナスの値となっていることがわかる。 </p><div class="figure"><center> 
<img src="images/img-0041.png" alt="\includegraphics[width=15cm]{kekka.ps}" style="width:15cm" /> </center></div><h2 id="a0000000117">3.11 残差のチェック</h2>
<p>HLM6では，結果の出力にレベル1の（この場合は学校ごとの）切片や傾きの推定値は出力されない。 これらについては残差ファイルの中に格納されているため，必要であればこちらを確認する必要がある。 また，残差の確認はモデルの仮定が成り立っているかどうかをチェックするためにも有効である。 </p><p>デフォルトでは，MDMファイルを格納したフォルダに残差ファイルが格納されているはずである。 <a href="#a0000000118" class="footnote"><sup class="footnotemark">53</sup></a> </p><h3 id="a0000000119">レベル1の残差ファイル</h3>
<div class="figure"><center> 
<img src="images/img-0042.png" alt="\includegraphics[width=14cm]{zansa1.ps}" style="width:14cm" /> </center></div><p> "l1resid"とあるのが，レベル1の残差である。 "fitval"がモデル式によって予測された従属変数の値であり，これら2つの値を合計すると"mathach"と等しくなる。 </p><h3 id="a0000000120">レベル2の残差ファイル</h3>
<div class="figure"><center> 
<img src="images/img-0043.png" alt="\includegraphics[width=14cm]{zansa2.ps}" style="width:14cm" /> </center></div><p>レベル2の残差ファイルにはかなり多くの情報が格納されているので，重要と思われるものだけを以下にピックアップして説明した。 </p><dl class="description">

    <dt>  "eb・・・":</dt>
    <dd><p>"ebintrcp"とあるのは， <a href="#a0000000121" class="footnote"><sup class="footnotemark">54</sup></a> レベル1の切片（<img src="images/img-0044.png" alt="$\beta _{0j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）の推定に経験ベイズ（empirical Bayes）法を用いた際の残差（<img src="images/img-0045.png" alt="$u_{0j}$" style="vertical-align:-4px; 
                                     width:22px; 
                                     height:11px" class="math gen" />）である。 同様に"ebses"とあるのは，レベル1の傾き（<img src="images/img-0046.png" alt="$\beta _{1j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）に経験ベイズ法を用いた際の残差（<img src="images/img-0047.png" alt="$u_{1j}$" style="vertical-align:-4px; 
                                     width:22px; 
                                     height:11px" class="math gen" />）である。 </p></dd>

    <dt>  "ol・・・":</dt>
    <dd><p>"olintrcp"，"olses"とあるのは，それぞれレベル1の切片（<img src="images/img-0044.png" alt="$\beta _{0j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）および傾き（<img src="images/img-0046.png" alt="$\beta _{1j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）を（学校ごとに）通常の最小2乗（ordinary least-squares）法で推定した際の残差（<img src="images/img-0045.png" alt="$u_{0j}$" style="vertical-align:-4px; 
                                     width:22px; 
                                     height:11px" class="math gen" />および<img src="images/img-0047.png" alt="$u_{1j}$" style="vertical-align:-4px; 
                                     width:22px; 
                                     height:11px" class="math gen" />）である。 <a href="#a0000000122" class="footnote"><sup class="footnotemark">55</sup></a> この方法では経験ベイズ法の場合と異なりサンプル全体の情報を使っていないので，"eb・・・"で示した残差よりもこちらの方が残差（の絶対値）は大きくなっている。 </p></dd>

    <dt>  "fv・・・":</dt>
    <dd><p>それぞれレベル1の切片と傾きのレベル2モデルによる予測値である。 </p></dd>

    <dt>  "ec・・・":</dt>
    <dd><p>それぞれ <a href="#a0000000123" class="footnote"><sup class="footnotemark">56</sup></a> レベル1の切片と傾きの経験ベイズ推定値である。 これは，予測値("fv・・・")に残差の値("eb・・・")を足したものに等しい。 </p></dd>

</dl></div>



<div id="footnotes">
<p><b>Footnotes</b></p>
<ol>
<li id="a0000000013">仮にHLM6をC:￥Program Files￥HLM6Sにインストールした場合，C:￥Program Files￥HLM6S￥Examples￥AppendxAにデータファイルが含まれる。</li><li id="a0000000014">同じデータを使った同様の分析例がRaudenbush &amp; Bryk(2002)に載っている。</li><li id="a0000000016">ここで，<img src="images/img-0048.png" alt="$i$" style="vertical-align:0px; 
                                     width:5px; 
                                     height:11px" class="math gen" />は生徒，<img src="images/img-0049.png" alt="$j$" style="vertical-align:-3px; 
                                     width:8px; 
                                     height:14px" class="math gen" />は学校を表す。また，<img src="images/img-0050.png" alt="$\bar{SES_{.j}}$" style="vertical-align:-4px; 
                                     width:42px; 
                                     height:20px" class="math gen" />は，<img src="images/img-0049.png" alt="$j$" style="vertical-align:-3px; 
                                     width:8px; 
                                     height:14px" class="math gen" />番目の学校の生徒のSESの平均である。このようなセンタリングを行う方法および理由については後で述べる。</li><li id="a0000000018"> <table id="a0000000124" cellpadding="7" width="100%" cellspacing="0" class="eqnarray">
<tr id="a0000000125">
    
    <td style="width:40%">&nbsp;</td>
    
    
        <td style="vertical-align:middle;                                    text-align:right"><img src="images/img-0051.png" alt="$\displaystyle  SECTOR= \begin{cases}  1 ~ (\text {Catholic}) \\ 0 ~ (\text {public}) \end{cases} \notag  $" style="vertical-align:-22px; width:196px;                     height:51px" class="math gen" /></td>
    
    
    
    <td style="width:40%">&nbsp;</td>
    <td style="width:20%" class="eqnnum"><span>(<span>2</span>)</span></td>
</tr>
</table> </li><li id="a0000000019">レベル2の式には確率的に変動する誤差成分（<img src="images/img-0052.png" alt="$u_{0j}, \  u_{1j}$" style="vertical-align:-4px; 
                                     width:58px; 
                                     height:11px" class="math gen" />）が含まれている。 これは，レベル1の切片および傾きには今回用意した2つの説明変数（SECTOR,  MEANSES）のみでは説明できない独自の成分があるということを示している。</li><li id="a0000000023">今回の分析例では2レベルのモデルを用いるため，必要となるデータファイルの数は2つである。</li><li id="a0000000024">SPSS, SAS, SYSTAT, STATAで作成したデータファイルが使える。</li><li id="a0000000027">今回の分析例では，各生徒の所属する学校のIDである。生徒個人のIDではないことに注意。</li><li id="a0000000028">同じ学校に所属する生徒はまとめて同じところに。</li><li id="a0000000029">欠測値は"."で代用できるが，欠測値のあるケースは分析の途中で除外される。（<a href="sect0003.html#kessoku">*</a>ページを参照。）</li><li id="a0000000035">プログラムとともに提供されているサンプルデータでは，小数点以下の桁を表示しないよう設定されているはずであるが，ここではわかりやすいようにASCII形式のデータと同じように表示されるよう設定を変えてある。データの内容そのものは同じである。</li><li id="a0000000037">MDMファイルに相当するものは，以前のバージョンであるHLM5までは，SSM（Sufficient Statistics Matrix）ファイルといっていたが，バージョン6への改定の際に変更された。</li><li id="a0000000039">もしショートカットがなければ，"HLM6S"フォルダ内の"WHLMS.exe"ファイルをダブルクリックしてもよい。 あるいは，"WHLMS.exe"を右クリックし，[送る]→[デスクトップ（ショートカットを作成）]で，デスクトップ上にショートカットを作成することができる。</li><li id="a0000000041">今回の例では2レベルモデルなので，"HLM2"を選択する。</li><li id="a0000000043">ここでは，"hsb-gd.mdm"とした。</li><li id="a0000000045">ここでは，「学校という集団内の個人」を対象にしたデータであることから"persons within groups"を選択した。</li><li id="a0000000047">ここでは"C:￥Program Files￥HLM6S￥Examples￥AppendxA￥hsb1.dat" と入力するか，そのファイルを選択する。</li><li id="a0000000048">ここでは，"4"とした。</li><li id="a0000000049">今回の例では欠測はないのでそのままでよい。デフォルトでは欠測はないものとして扱われる。</li><li id="a0000000050">ここでは"(A4,4F12.3)"と入力する。"(" や ")" を忘れると警告が出る。</li><li id="a0000000051">"4F12.3"は，12カラムを占める小数点以下3桁までのデータが4つあるという意味になる。実際にデータファイル"hsb1.dat"を確認されたい。</li><li id="a0000000052">例えば"8X"であればデータ読み込みの際に8カラム飛ばすということになる。</li><li id="a0000000053">ここでは，順に"MINORITY", "FEMALE", "SES", "MATHACH"とする。</li><li id="a0000000055">データファイルは，C:￥Program Files￥HLM6S￥Examples￥AppendxA￥hsb2.dat と入力するか，そのファイルを選択する。 変数の数は6個で，Data Formatには"(A4,6F12.3)"と入力する。 また，変数名については順に"SIZE"，"SECTOR"，"PRACAD"，"DISCLIM"，"HIMINTY"，"MEANSES"とする。</li><li id="a0000000057">データファイルの種類や変数の数，カラム指定，欠測値に関する情報など。実際にテキストエディタで開いてみるとMDMファイルを作る際に指定した内容が確認できる。</li><li id="a0000000058">MDMTファイルを用いれば，以前に作成したMDMファイルを簡単に編集し直すことができる。[File]-[Make new MDM from old MDM template (.mdmt) file]メニューからMDMTファイルを指定すれば，MDMファイルを作成する画面に移動する。</li><li id="a0000000060">この画面は，数秒間現れたのち自動的に消える。</li><li id="a0000000062">STSファイルは自動的に作成され，あらかじめファイル名を指定することはできない。</li><li id="a0000000064">MDMファイルが指定された後は，[File]-[Display MDM stats]でMDMファイルに含まれる情報の一部を確認することができる。</li><li id="a0000000066">ASCII形式のときと同様，今回の例では2レベルモデルなので，"HLM2"を選択する。</li><li id="a0000000068">ここでは，"hsb-gd.mdm"とした。</li><li id="a0000000070">ここでは"SPSS/Windows"を選択（デフォルト）。</li><li id="a0000000072">ここでは，「学校という集団内の個人」を対象にしたデータであることから"persons within groups"を選択した。</li><li id="a0000000074">ここでは"C:￥Program Files￥HLM6S￥Examples￥AppendxA￥hsb1.sav" を選択した。</li><li id="a0000000075">hsb1.savには欠測値はないのでデフォルトのままでよい。</li><li id="a0000000077">ここでは"C:￥Program Files￥HLM6S￥Examples￥AppendxA￥hsb2.sav" を選択した。</li><li id="a0000000079">ここでは，"hsb-gd.mdmt"とした。</li><li id="a0000000081">この画面は，数秒間現れたのち自動的に消える。</li><li id="a0000000083">STSファイルは自動的に作成され，あらかじめファイル名を指定することはできない。</li><li id="a0000000086">以前に作成したMDMファイルを再利用する際は，[File]-[Create a new model using an existing MDM file]メニューからMDMファイルを選択すれば，モデル指定の画面に移る。</li><li id="a0000000088">この場合，切片<img src="images/img-0026.png" alt="$\beta _0$" style="vertical-align:-3px; 
                                     width:15px; 
                                     height:14px" class="math gen" />は各学校における数学成績の平均の推定値となる。これは，レベル2モデルにSESの平均である"MEANSES"を入れることから，多重共線性を避けるための措置でもある。HLM6では，その他にも全体平均でのセンタリングを行うこともできる。センタリングを行った際は，切片の意味が代わってくることに注意する必要がある。</li><li id="a0000000090">同様に，レベル2の他の誤差成分についてもその部分をクリックすることでモデルからはずしたり投入しなおしたりすることができる。レベル1の誤差成分ははずすことはできない。</li><li id="a0000000092">オプションであるので，必須というわけではないが，残差ファイルに関してはここで指定しないと作成されない。</li><li id="a0000000094">もしくは，[Level-1]の上の[Outcome]をクリックしてもよい。</li><li id="a0000000096">ここで仮に"Free Format"を選択し，テキストファイル（.txt）やCSVファイル（.csv）で保存すると，カンマ区切りの残差ファイルが作成される。SPSSがなければこのようにして作成した残差ファイルをあとでExcelなどで開けばよい。（テキストエディタで開いてもよいが，見づらい。）</li><li id="a0000000098">デフォルトでは"no title"となっている。このままでもよいが，今回は"HSB-GD"とした。</li><li id="a0000000101">分析モデルのタイプとしてHMLMを選択した場合は，拡張子を".mlm"として保存するとよい。</li><li id="a0000000102">ここでは，"hsb-gd.hlm"とした。</li><li id="a0000000104">もしHLMファイルを保存し忘れた場合は，ここで保存するよう促される。</li><li id="a0000000105">もし指定した回数よりも多くの反復計算を必要とした場合は，所定の回数計算し終わった後，さらに続けるかどうか確認される。</li><li id="a0000000106">今回は[Basing Settings]において結果のファイル名をデフォルトのままとしたので，ここでは"hlm2.txt"となっている。もしファイル名を指定していれば，そのファイルが自動的に立ち上がる。</li><li id="a0000000107">以下，"#"〜"#"で囲んだ部分は，後から付け加えたコメントである。</li><li id="a0000000118">もちろん分析の際に指定しなければ作成されない。</li><li id="a0000000121">経験ベイズ法では，レベル1の切片と傾きについて，学校ごとに最小2乗法を用いて推定した値（次に述べる"ol・・・"で示された値）とレベル2のモデル式にもとづく推定値とをそれぞれの信頼性で重み付けした値を最終的な推定値とする。</li><li id="a0000000122">"ebintrcp"と"olintrcp"，"ebses"と"olses"の値を実際に比較されたい。</li><li id="a0000000123">今回の分析例では，学校ごとの切片（<img src="images/img-0044.png" alt="$\beta _{0j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）および傾き（<img src="images/img-0046.png" alt="$\beta _{1j}$" style="vertical-align:-4px; 
                                     width:21px; 
                                     height:15px" class="math gen" />）の推定値となる。<a href="sect0003.html#graph.graph3">*</a>ページで示したグラフは，こちらの値を用いて描かれたものである。</li>
</ol>
</div>

<div class="navigation">
<table cellspacing="2" cellpadding="0" width="100%">
<tr>
<td><a href="sect0002.html" title="HLM6について"><img alt="Previous: HLM6について" border="0" src="icons/previous.gif" width="32" height="32" /></a></td>

<td><a href="index.html" title="階層的線形モデルによるデータ分析の実際1 — HLM6，SAS，Rを利用して —"><img alt="Up: 階層的線形モデルによるデータ分析の実際1 — HLM6，SAS，Rを利用して —" border="0" src="icons/up.gif" width="32" height="32" /></a></td>

<td><a href="sect0004.html" title="SAS PROC MIXEDによる分析"><img alt="Next: SAS PROC MIXEDによる分析" border="0" src="icons/next.gif" width="32" height="32" /></a></td>

<td class="navtitle" align="center">階層的線形モデルによるデータ分析の実際<a href="#a0000000008" class="footnote"><sup class="footnotemark">1</sup></a> <br />— HLM6，SAS，Rを利用して —</td>
<td><a href="index.html" title="Table of Contents"><img border="0" alt="" src="icons/contents.gif" width="32" height="32" /></a></td>


<td><img border="0" alt="" src="icons/blank.gif" width="32" height="32" /></td>
<td><img border="0" alt="" src="icons/blank.gif" width="32" height="32" /></td>
</tr>
</table>
</div>

<script language="javascript" src="icons/imgadjust.js" type="text/javascript"></script>

</body>
</html>